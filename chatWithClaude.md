[](https://claude.ai/new)

* [Start new chat](https://claude.ai/new)
* [Projects](https://claude.ai/projects)
* [Chats](https://claude.ai/recents)

### Starred

* [Generating Effective Marketing System Prompts](https://claude.ai/chat/9c6fead4-c2c5-4ca4-8bbe-0cce0caf4f27)

### Recents

* [Installing Code Editor Themes Like Claude UI](https://claude.ai/chat/431aae93-535b-4b1d-ba74-a4b76bf189ac)
* [Leveraging MongoDB Atlas Triggers for YouTube Analytics](https://claude.ai/chat/ffd6446b-41e8-427d-962d-49ad14265aee)
* [Getting Started with MongoDB Atlas: A Comprehensive Guide](https://claude.ai/chat/88c0f6dd-171c-46b8-8c89-0592cdb99809)
* [Effective Marketing Copywriting Techniques](https://claude.ai/chat/42ec2d86-4082-41d6-b7bc-de5a8df6b784)
* [Leveraging AI for Business Professionals](https://claude.ai/chat/dfdb1258-fd77-4ead-b8f4-8370dc95d017)
* [Crafting Captivating Tech Influencer Content](https://claude.ai/chat/b53e6e14-a5bb-4145-8b45-acd6005fa07f)
* [Optimizing Database Structure and Data Management for View Trap](https://claude.ai/chat/d5f46c15-348a-4916-83d7-deccf74f0753)
* [Streamlining Retail Management with Smart CCTV](https://claude.ai/chat/8b6226e6-ce3c-4e50-b13e-eb738f3d5175)
* [Become a Lucrative CCTV Technician in 4 Weeks](https://claude.ai/chat/9c97284a-2a3c-4688-9f13-35a6f97a0186)
* [Improving Readability of Landing Page](https://claude.ai/chat/7af67f30-baf5-4fff-b32d-ec066d651189)
* [Reverse-Engineering Effective Landing Page Design](https://claude.ai/chat/43de9e52-08e9-4aab-b59f-70b3c730cc13)
* [Onboarding Process and Payment Terms for Payple](https://claude.ai/chat/929c8cd4-1452-4af0-8cde-fdcc800aeb02)
* [(New chat)](https://claude.ai/chat/e8ba5134-0cf9-487f-930a-dee612707b38)
* [The True Meaning of Execution](https://claude.ai/chat/3d6187ab-addf-4b9d-8e93-9411d2c88633)
* [Avoiding Questionable &#34;Get Rich Quick&#34; Schemes](https://claude.ai/chat/7f8d028b-8d7e-4f89-9dba-14c02540625e)
* [Business Registration Details](https://claude.ai/chat/bb1e1927-13eb-4f47-8e27-2f77558b976d)
* [💬 스크린 리더 지원이 사용 설정되었습니다.     드라이...](https://claude.ai/chat/4d5237fb-0db9-4af3-9592-9a026fcffcdb)
* [Reverse-Engineering a Blog Post for CCTV Security](https://claude.ai/chat/ae64e4d2-85e0-4771-bda3-ca161a1b3432)
* [Customizing Zen Browser with Themes and Plugins](https://claude.ai/chat/74e8f443-10a4-41f1-bdfb-7d9ffed41bca)
* [Verifying Correct Implementation of Knowledge Database Functions](https://claude.ai/chat/328c3139-06dd-4039-829c-c9a6e4d3d63f)
* [Automating Instagram Likes and Interactions](https://claude.ai/chat/ad0c3678-7871-4e8c-af99-0c7a3faad22d)
* [Monetizing Tech Skills: Pulling Content and Conversion Strategies](https://claude.ai/chat/7883be0f-bd79-41ac-805f-3d32cfd1f1a3)
* [Insider Tips for Tech Entrepreneurs to Become &#34;Tech Billionaires&#34;](https://claude.ai/chat/221250bf-0f2a-4b2d-b69e-b8737bf7de32)
* [Proven Strategies for Tech Professionals to Become Wealthy](https://claude.ai/chat/826f708e-531e-4f99-8bba-5e1440f35525)
* [Troubleshooting API Key Access in Next.js](https://claude.ai/chat/c3fb07c2-10f5-47b0-a589-a538216aebd6)
* [Automate Your Workflow with AI: Boost Productivity and Simplify Tasks](https://claude.ai/chat/dc6e8b34-55a0-4b16-a7e8-dca8b9476627)
* [Upgrading Landing Page Copy and Design](https://claude.ai/chat/1f2129e7-0879-4aa4-9c54-189e8296998e)
* [TEC카페_세미나후기_템플릿](https://claude.ai/chat/0be3c654-3dce-4f97-84b6-14e23ace21c4)
* [Crafting Impactful Copy for Tech Education Center Landing Page](https://claude.ai/chat/3e6484b8-db6c-4750-b93d-29ceb0251a14)
* [Visualizing Key Patterns in Marketing Copywriting](https://claude.ai/chat/0257c0ad-0da3-4297-969e-23cd56baa561)

[View all](https://claude.ai/recents)

Professional plan

S

tlswkehd@gmail.com

S

Leveraging MongoDB Atlas Triggers for YouTube Analytics

[](https://claude.ai/new)

4

Share

shinws890810760 1초 전 몽고 db 아틀라스, 날 완전히 이해시켜줘 죄송합니다, 문제가 발생했습니다 나중에 다시 시도해 주세요. 몽고 db아틀라스를 날 완전히 이해시켜줘 답변 MongoDB Atlas는 클라우드 기반의 완전 관리형 NoSQL 데이터베이스 서비스로, 개발자가 인프라 관리 없이 문서 지향 데이터 모델과 분산

pasted

dataMath3

md

S

Edit

Based on your files, I'll provide you with a comprehensive understanding of MongoDB Atlas and how to leverage its triggers for your YouTube analytics application.

# MongoDB Atlas: A Complete Overview

MongoDB Atlas is a fully managed database-as-a-service offering that handles all the complexity of deploying, managing, and scaling MongoDB deployments in the cloud. Here's a deep dive into its capabilities and how they apply to your YouTube analytics application:

## Key Features of MongoDB Atlas

1. **Cloud-Based Infrastructure**
   * Runs on AWS, Google Cloud, and Azure across 80+ regions
   * 99.995% uptime guarantee with automatic failover
   * Eliminates the need to manage your own database servers
2. **Auto-scaling Capabilities**
   * Vertical scaling: Upgrade from M10 to larger tiers as needed
   * Horizontal scaling: Distribute data across multiple servers via sharding
   * Auto-scale clusters based on real-time traffic patterns
3. **Advanced Security**
   * Encryption at rest (AES-256) and in transit (TLS 1.3)
   * Network isolation via IP whitelisting and VPC peering
   * Role-based access control and integration with LDAP/SAML

## Leveraging Triggers for Your YouTube Analytics App

Based on your application needs and the documents you provided, here's how to effectively implement Atlas Triggers:

### Multi-Stage Trigger Architecture

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs"></div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code><span class=""><span class="">flowchart TD
</span></span><span class="">    A[User Searches Keyword] --> B{Keyword in DB?}
</span><span class="">    B -->|Yes| C[Return Cached Data]
</span><span class="">    B -->|No| D[Trigger 1: YouTube API/Scraping]
</span><span class="">    D --> E[Trigger 2: AI Analysis]
</span><span class="">    E --> F[Save Results to DB]
</span><span class="">    F --> G[Notify User]
</span><span class="">    H[Trigger 3: Data Freshness] --> D</span></code></div></div></div></pre>

### 1. Data Acquisition Trigger

This trigger activates when a new keyword is searched but not found in your database:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">changeEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> newKeyword </span><span class="token operator">=</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// Check if we need to fetch new data</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> exists </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> newKeyword</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">exists </span><span class="token operator">===</span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Option 1: Using YouTube API</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> youtubeData </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.googleapis.com/youtube/v3/search?part=snippet&q=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">newKeyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&key=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">context</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">values</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation method function property-access">get</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation string">"YOUTUBE_API_KEY"</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&type=video&maxResults=10</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">encodeBodyAsJSON</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// Option 2: Trigger serverless function for web scraping</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">functions</span><span class="token punctuation">.</span><span class="token method function property-access">execute</span><span class="token punctuation">(</span><span class="token string">"runPlaywrightScraper"</span><span class="token punctuation">,</span><span class=""> newKeyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// Update status to processing</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> newKeyword </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

### 2. AI Analysis Trigger (Scheduled)

This runs every few minutes to process any pending data:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Find all keywords with status "0" (processing)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingKeywords </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class=""></span><span class="token comment">// Process in batches</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> keywordDoc </span><span class="token keyword">of</span><span class=""> pendingKeywords</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Get video data</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> keywordDoc</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">round_no</span><span class="token operator">:</span><span class=""> keywordDoc</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">videos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Run AI analysis on videos</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Calculate hook index, growth index as defined in your dataMath3.md</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> video </span><span class="token keyword">of</span><span class=""> videos</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> hookIndex </span><span class="token operator">=</span><span class=""></span><span class="token function">calculateHookIndex</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">,</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> growthIndex </span><span class="token operator">=</span><span class=""></span><span class="token function">calculateGrowthIndex</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">,</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">publishDate</span><span class="token punctuation">,</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token comment">// Update video with analysis</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">              hookIndex</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">              growthIndex</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">exposureProbability</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateExposureProbability</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">,</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">analysisComplete</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// Mark keyword as complete</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> keywordDoc</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

### 3. Data Freshness Trigger (Daily)

This runs once a day to keep data fresh:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Find keywords with old data (older than 7 days)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> oldKeywords </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">-</span><span class=""></span><span class="token number">7</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class=""></span><span class="token comment">// Process in batches</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> keyword </span><span class="token keyword">of</span><span class=""> oldKeywords</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Mark for refresh</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">scheduler_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

## Optimizing Triggers for Performance and Cost

1. **Efficient Data Fetching**
   * Use batch operations whenever possible (process multiple items in one trigger execution)
   * Implement incremental updates (only fetch changes since last update)
   * Cache common AI analysis results
2. **Error Handling and Retry Logic**
   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// Your trigger code</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// Log the error</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Error processing keyword: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// Implement exponential backoff retry</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">retryCount </span><span class="token operator"><</span><span class=""></span><span class="token number">3</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"retryQueue"</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token literal-property property">retryCount</span><span class="token operator">:</span><span class=""> retryCount </span><span class="token operator">+</span><span class=""></span><span class="token number">1</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token literal-property property">nextRetry</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class=""> retryCount</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// Mark as failed after max retries</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">errorMessage</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>
3. **Rate Limiting for External APIs**
   * Implement throttling to avoid YouTube API quota limits
   * Track daily API usage and adjust processing rates

## Integration with Your NextJS Application

Since you're using NextJS, you can integrate this with your API routes:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// pages/api/youtube/search/[keyword].ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token keyword">type</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'../../../../lib/mongodb'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">handler</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class="">  req</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">  res</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> db </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// Check if we have this keyword cached</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> existingKeyword </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">existingKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Return cached data</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no</span><span class="token operator">:</span><span class=""> existingKeyword</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> videos</span><span class="token punctuation">,</span><span class=""> history</span><span class="token operator">:</span><span class=""> existingKeyword </span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// Create new keyword request</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> newKeyword </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    newKeyword</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    country</span><span class="token operator">:</span><span class=""></span><span class="token string">"KR"</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">    lang</span><span class="token operator">:</span><span class=""></span><span class="token string">"ko"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    round_no</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    uid</span><span class="token operator">:</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">'user-id'</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">'anonymous'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    create_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="">newKeyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// The trigger will handle the YouTube API call and processing</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">      history</span><span class="token operator">:</span><span class=""> newKeyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      message</span><span class="token operator">:</span><span class=""></span><span class="token string">'Your request is being processed. Check back shortly.'</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## Key Advantages for Your Use Case

1. **Reduced Backend Complexity** : Triggers handle the complex processing flow without you needing to maintain separate workers or queues.
2. **Cost Efficiency** : Only pay for processing when needed, rather than running always-on servers.
3. **Scalability** : Automatically scales to handle traffic spikes without additional configuration.
4. **Maintainability** : Centralized logic in triggers makes it easier to update processing pipelines.

By leveraging MongoDB Atlas triggers for your YouTube analytics application, you can create a more responsive, scalable system that efficiently manages the data acquisition, processing, and analysis workflow while keeping costs under control.

Retry

S

한국어로 대답해.
그럼, 사용자가 키워드를 검색하자마자, triggers에서 바로 해당 키워드를 api에요청하는 것도 좋지만, 직접 브라우징을 해서 더 상세한 정보를 가져오면, 구글api에서 제한하는 api호출 사용량 제한에 걸리지도 않을것같아. 실제 브라우징이나 크롤링을 trigger로 실행하는 걸 말하는거야

Edit

MongoDB Atlas 트리거를 사용하여 실제 브라우징이나 크롤링을 실행하는 접근 방식은 매우 효과적인 전략입니다. 이 방법을 통해 YouTube API 호출 제한을 우회하면서 더 풍부한 데이터를 수집할 수 있습니다.

## MongoDB Atlas 트리거로 브라우저 자동화 구현하기

MongoDB Atlas의 트리거 기능을 활용하여 Playwright나 Selenium 같은 브라우저 자동화 도구를 실행하는 방법을 설명해 드리겠습니다:

### 1. 아키텍처 구성

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs"></div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code><span class=""><span class="">사용자 검색 요청 → MongoDB 이벤트 발생 → Atlas 트리거 활성화 → 외부 서버리스 함수 호출 → 브라우저 자동화 실행 → 결과 저장</span></span></code></div></div></div></pre>

### 2. 구현 방법 (2가지 접근법)

#### 방법 1: AWS Lambda 연동

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// MongoDB Atlas 트리거 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">changeEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> keyword </span><span class="token operator">=</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// AWS Lambda 함수 호출 (브라우저 자동화 실행)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""></span><span class="token string">"https://your-aws-region.amazonaws.com/lambda-function"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">"Content-Type"</span><span class="token operator">:</span><span class=""></span><span class="token string">"application/json"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">"x-api-key"</span><span class="token operator">:</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">values</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"AWS_API_KEY"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">historyId</span><span class="token operator">:</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 크롤링 작업 시작 표시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">crawling_status</span><span class="token operator">:</span><span class=""></span><span class="token string">"processing"</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

AWS Lambda에서는 Chrome을 headless 모드로 실행하는 Playwright/Selenium 스크립트를 작동시킵니다:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// AWS Lambda 함수 (Node.js)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> chromium </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'playwright-aws-lambda'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token maybe-class-name">MongoClient</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class="">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">handler</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> historyId </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="">event</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> browser</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// Playwright 브라우저 실행</span><span class="">
</span></span><span class=""><span class="">    browser </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> chromium</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> context </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> page </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// YouTube 접속 및 검색</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.youtube.com/results?search_query='</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="">keyword</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'ytd-video-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 비디오 정보 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> results </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> items </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'ytd-video-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class="">      items</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoId </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'a#thumbnail'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'v='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'&'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> title </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#video-title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> views </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#metadata-line span:first-child'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> publishTime </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#metadata-line span:last-child'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelName </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#channel-name a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelId </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#channel-name a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'/channel/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> thumbnail </span><span class="token operator">=</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://i.ytimg.com/vi/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">videoId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">/hqdefault.jpg</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class="">        results</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          videoId</span><span class="token punctuation">,</span><span class=""> title</span><span class="token punctuation">,</span><span class=""> views</span><span class="token punctuation">,</span><span class=""> publishTime</span><span class="token punctuation">,</span><span class=""> channelName</span><span class="token punctuation">,</span><span class=""> channelId</span><span class="token punctuation">,</span><span class=""> thumbnail
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> results</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 채널 상세 정보 수집 (구독자 수 등)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> video </span><span class="token keyword">of</span><span class=""> videos</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.youtube.com/channel/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">video</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">channelId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'#subscriber-count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> subscribers </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">$eval</span><span class="token punctuation">(</span><span class="token string">'#subscriber-count'</span><span class="token punctuation">,</span><span class=""></span><span class="token parameter">el</span><span class=""></span><span class="token arrow operator">=></span><span class=""> el</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      video</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class=""></span><span class="token operator">=</span><span class=""> subscribers</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// MongoDB에 결과 저장</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> client </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="">process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> db </span><span class="token operator">=</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'youtube_analytics'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 비디오 데이터 저장</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class="">      videos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">video</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">video</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        historyId</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">createdAt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 키워드 히스토리 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">MongoDB</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">ObjectId</span><span class="token punctuation">(</span><span class="">historyId</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">crawling_status</span><span class="token operator">:</span><span class=""></span><span class="token string">"completed"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">video_count</span><span class="token operator">:</span><span class=""> videos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">completed_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">statusCode</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">success</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">videoCount</span><span class="token operator">:</span><span class=""> videos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'크롤링 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 오류 기록</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> client </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="">process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'youtube_analytics'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">MongoDB</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">ObjectId</span><span class="token punctuation">(</span><span class="">historyId</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">crawling_status</span><span class="token operator">:</span><span class=""></span><span class="token string">"failed"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">statusCode</span><span class="token operator">:</span><span class=""></span><span class="token number">500</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">success</span><span class="token operator">:</span><span class=""></span><span class="token boolean">false</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">finally</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">browser</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

#### 방법 2: 전용 크롤링 서버 구축

더 복잡한 크롤링이 필요하다면 전용 서버를 구축하고 API 엔드포인트를 만들어 Atlas 트리거에서 호출하는 방법도 있습니다:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// MongoDB Atlas 트리거</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">changeEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> keyword </span><span class="token operator">=</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 전용 크롤링 서버 API 호출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""></span><span class="token string">"https://your-crawling-server.com/api/crawl"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token string-property property">"Content-Type"</span><span class="token operator">:</span><span class=""></span><span class="token string">"application/json"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">historyId</span><span class="token operator">:</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">apiKey</span><span class="token operator">:</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">values</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"CRAWLER_API_KEY"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

### 3. 최적화 및 주의사항

1. **IP 차단 방지**
   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// 브라우저 설정에 User-Agent 회전 및 타임아웃 추가</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> browser </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> chromium</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> context </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token literal-property property">userAgent</span><span class="token operator">:</span><span class=""></span><span class="token function">getRandomUserAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token literal-property property">viewport</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">width</span><span class="token operator">:</span><span class=""></span><span class="token number">1920</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">height</span><span class="token operator">:</span><span class=""></span><span class="token number">1080</span><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">
   </span><span class=""><span class=""></span><span class="token comment">// 요청 간 랜덤 지연 추가</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForTimeout</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">3000</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></div></div></div></pre>
2. **크롤링 결과 검증**
   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// 데이터 검증 함수</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">validateVideoData</span><span class="token punctuation">(</span><span class="token parameter">video</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'필수 데이터 누락: '</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 조회수 문자열을 숫자로 변환 (예: "1.2만회" → 12000)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'string'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">    video</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">parseKoreanNumberFormat</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> video</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>
3. **자원 관리**
   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// 브라우저 인스턴스를 재사용하여 시작 시간 단축</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> browser</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">
   </span><span class=""><span class="">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">handler</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// 브라우저가 없으면 시작</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">browser</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">      browser </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> chromium</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> context </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// 크롤링 작업...</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// 오류 발생 시 브라우저 재시작</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">browser</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class="">      browser </span><span class="token operator">=</span><span class=""></span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

### 4. 실제 구현 사례

뷰트랩(ViewTrap) 같은 서비스에서는 다음과 같은 방식으로 구현할 수 있습니다:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// MongoDB Atlas 트리거 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">changeEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> uid </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 1. 키워드 검색 결과 페이지 크롤링</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> crawlerResponse </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">CRAWLER_SERVICE_URL</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">action</span><span class="token operator">:</span><span class=""></span><span class="token string">"search_results"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> searchResults </span><span class="token operator">=</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="">crawlerResponse</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 2. MongoDB에 초기 결과 저장</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"viewtrap"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class="">      searchResults</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">video</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">video</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"partial"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 부분 데이터만 수집된 상태</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">created_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 3. 개별 비디오 상세 정보 수집 (비동기 작업 예약)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> video </span><span class="token keyword">of</span><span class=""> searchResults</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"viewtrap"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"crawlQueue"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">videoId</span><span class="token operator">:</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">type</span><span class="token operator">:</span><span class=""></span><span class="token string">"video_details"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"pending"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">created_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 4. 키워드 상태 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"viewtrap"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">initial_crawl_complete</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">video_count</span><span class="token operator">:</span><span class=""> searchResults</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

다음으로 크롤링 큐를 처리하는 별도의 예약 트리거를 만듭니다:

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// 정기적으로 실행되는 크롤링 큐 처리 트리거</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> db </span><span class="token operator">=</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"viewtrap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 처리할 작업 가져오기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingTasks </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"crawlQueue"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"pending"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> task </span><span class="token keyword">of</span><span class=""> pendingTasks</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 작업 상태 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"crawlQueue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"processing"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">started_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 크롤링 작업 실행</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">CRAWLER_SERVICE_URL</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">videoId</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">action</span><span class="token operator">:</span><span class=""></span><span class="token string">"video_details"</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoDetails </span><span class="token operator">=</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 비디오 정보 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">videoId</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">videoDetails</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"complete"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">hookIndex</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateHookIndex</span><span class="token punctuation">(</span><span class="">videoDetails</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">,</span><span class=""> videoDetails</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">growthIndex</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateGrowthIndex</span><span class="token punctuation">(</span><span class="">videoDetails</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">,</span><span class=""> videoDetails</span><span class="token punctuation">.</span><span class="token property-access">publishDate</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">updated_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 작업 완료 표시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"crawlQueue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"completed"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">completed_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"crawlQueue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> task</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"failed"</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">failed_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 모든 비디오가 처리되었는지 확인하고 키워드 상태 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> keywords </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">initial_crawl_complete</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> keyword </span><span class="token keyword">of</span><span class=""> keywords</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingVideos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"videos"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">keyword</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"partial"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">pendingVideos </span><span class="token operator">===</span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 모든 비디오 처리 완료</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">completed_at</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

이러한 접근 방식을 사용하면 YouTube API 제한을 피하면서도 풍부한 데이터를 수집할 수 있으며, 처리 작업을 효율적으로 분산하여 시스템의 확장성과 안정성을 확보할 수 있습니다.

Retry

S

초반에 첨부한 내 문서 datamath3.md 를 읽어봐. 내 서비스의 데이터 구조를 모두 정확하게 파악한 뒤, 브라우저 스크래핑으로 가져올 수 있는 방법을 실제로 구체적으로 코드에 적용해서 알려주고 더 개선해줄 유저플로우와 사용자경험을 극대화시켜주는 프론트 스킬 성공사례들도 알려주면 고마울거같아

Edit

네, dataMath3.md 파일을 검토해 보았습니다. 이 파일에는 YouTube API v3와 관련된 데이터 매핑 및 통합 방법에 대한 상세한 내용이 포함되어 있습니다. 이제 귀하의 서비스 데이터 구조를 파악하고 브라우저 스크래핑 솔루션을 제공해 드리겠습니다.

# 서비스 데이터 구조 분석

## 핵심 모델

1. **KeywordHistory** - 사용자 검색 기록 관리
   * 상태 코드: "0"(처리 중), "1"(완료), "2"(실패)
   * 관련 필드: round_no, keyword, status, uid 등
2. **Video** - 비디오 상세 정보
   * 필수 필드: videoId, title, thumbnail, duration, views 등
   * 계산 필드: hookIndex, growthIndex, exposureProbability
3. **User** - 사용자 정보 관리
4. **MembershipLimit** - 멤버십별 사용 제한 관리

## 프로세스 흐름

1. 사용자가 키워드 검색
2. KeywordHistory 생성 (status: "0")
3. 백그라운드에서 비디오 데이터 수집
4. 분석 및 지수 계산
5. 결과 반환 (status: "1")

# 브라우저 스크래핑 솔루션

먼저 MongoDB Atlas 트리거와 Playwright를 활용한 스크래핑 솔루션을 구현해 보겠습니다.

## 1. 키워드 검색 결과 스크래핑 트리거

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token function-variable function">exports</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">changeEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 새 키워드 검색 트리거 (KeywordHistory 컬렉션에 새 문서 추가 시 실행)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no</span><span class="token punctuation">,</span><span class=""> uid </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 스크래핑 서버 호출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">http</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">url</span><span class="token operator">:</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">values</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"SCRAPING_SERVICE_URL"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">"Content-Type"</span><span class="token operator">:</span><span class=""></span><span class="token string">"application/json"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">"Authorization"</span><span class="token operator">:</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">context</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">values</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation method function property-access">get</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation string">"SCRAPING_SERVICE_TOKEN"</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">task</span><span class="token operator">:</span><span class=""></span><span class="token string">"youtube_search"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">params</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">maxResults</span><span class="token operator">:</span><span class=""></span><span class="token number">20</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 응답 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">statusCode</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token number">202</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 요청 수락됨 (비동기 처리 시작)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 작업 시작: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">, round_no: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">round_no</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 발생</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 서비스 오류: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">response</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">statusCode</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 기록</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">키워드 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> 처리 중 오류:</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// KeywordHistory 상태 업데이트 - 실패</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token property-access">services</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"mongodb-atlas"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">"youtube_analytics"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">"keywordHistory"</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class=""> changeEvent</span><span class="token punctuation">.</span><span class="token property-access">fullDocument</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 실패</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">error_message</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

## 2. 스크래핑 서버 구현 (Playwright)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">javascript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-javascript"><span class=""><span class="token comment">// scraping-service.js</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> express </span><span class="token operator">=</span><span class=""></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token maybe-class-name">MongoClient</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">ObjectId</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> chromium </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'playwright'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> app </span><span class="token operator">=</span><span class=""></span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="">express</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 환경 변수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token constant">MONGODB_URI</span><span class=""></span><span class="token operator">=</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token constant">PORT</span><span class=""></span><span class="token operator">=</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token number">3001</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token constant">API_TOKEN</span><span class=""></span><span class="token operator">=</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_TOKEN</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 인증 미들웨어</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">authenticate</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> authHeader </span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token property-access">authorization</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">authHeader </span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">authHeader</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""> authHeader</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">!==</span><span class=""></span><span class="token constant">API_TOKEN</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""></span><span class="token string">'인증 실패'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// YouTube 검색 결과 스크래핑</span><span class="">
</span></span><span class=""><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/scrape'</span><span class="token punctuation">,</span><span class=""> authenticate</span><span class="token punctuation">,</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> task</span><span class="token punctuation">,</span><span class=""> params </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">task </span><span class="token operator">!==</span><span class=""></span><span class="token string">'youtube_search'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">error</span><span class="token operator">:</span><span class=""></span><span class="token string">'지원하지 않는 작업'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no</span><span class="token punctuation">,</span><span class=""> uid</span><span class="token punctuation">,</span><span class=""> maxResults </span><span class="token operator">=</span><span class=""></span><span class="token number">10</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> params</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 작업 수락 응답</span><span class="">
</span></span><span class=""><span class="">  res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">202</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">message</span><span class="token operator">:</span><span class=""></span><span class="token string">'작업 수락됨'</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">task_id</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 비동기로 스크래핑 수행</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">(</span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> browser</span><span class="token punctuation">,</span><span class=""> client</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// MongoDB 연결</span><span class="">
</span></span><span class=""><span class="">      client </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> db </span><span class="token operator">=</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'youtube_analytics'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 브라우저 시작</span><span class="">
</span></span><span class=""><span class="">      browser </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> chromium</span><span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">headless</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> context </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">newContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">userAgent</span><span class="token operator">:</span><span class=""></span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">viewport</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">width</span><span class="token operator">:</span><span class=""></span><span class="token number">1920</span><span class="token punctuation">,</span><span class=""></span><span class="token literal-property property">height</span><span class="token operator">:</span><span class=""></span><span class="token number">1080</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 키워드 검색</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> page </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> context</span><span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.youtube.com/results?search_query=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&sp=CAASAhAB</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 조회수 순 정렬 파라미터 추가</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 쿠키 동의 대화상자 처리 (EU 지역 등에서 필요)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> consentButton </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'button[aria-label="Agree to the use of cookies and other data for the purposes described"]'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class=""></span><span class="token number">5000</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">consentButton</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> consentButton</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 쿠키 대화상자가 없는 경우 무시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 페이지 로딩 대기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'ytd-video-renderer, ytd-compact-video-renderer'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class=""></span><span class="token number">10000</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 스크롤 다운하여 더 많은 결과 로드 (maxResults에 맞게)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> scrolls </span><span class="token operator">=</span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">ceil</span><span class="token punctuation">(</span><span class="">maxResults </span><span class="token operator">/</span><span class=""></span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 한 번 스크롤에 약 5개 결과가 로드된다고 가정</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">let</span><span class=""> i </span><span class="token operator">=</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class=""> i </span><span class="token operator"><</span><span class=""> scrolls</span><span class="token punctuation">;</span><span class=""> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">scrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 로딩 대기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 비디오 정보 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> results </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> items </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'ytd-video-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class="">        items</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 비디오 ID 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoElement </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'a#thumbnail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoUrl </span><span class="token operator">=</span><span class=""> videoElement</span><span class="token operator">?.</span><span class="">href </span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoId </span><span class="token operator">=</span><span class=""> videoUrl</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'v='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'&'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 제목</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> titleElement </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#video-title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> title </span><span class="token operator">=</span><span class=""> titleElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 썸네일</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> thumbnailElement </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#thumbnail img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> thumbnail </span><span class="token operator">=</span><span class=""> thumbnailElement</span><span class="token operator">?.</span><span class="">src </span><span class="token operator">||</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://i.ytimg.com/vi/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">videoId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">/hqdefault.jpg</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 채널 정보</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelElement </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#channel-info a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelTitle </span><span class="token operator">=</span><span class=""> channelElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelUrl </span><span class="token operator">=</span><span class=""> channelElement</span><span class="token operator">?.</span><span class="">href </span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelId </span><span class="token operator">=</span><span class=""> channelUrl</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'/channel/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 메타데이터 (조회수, 업로드 시간)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> metadataElements </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'#metadata-line span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> views </span><span class="token operator">=</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> publishTime </span><span class="token operator">=</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">metadataElements</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">>=</span><span class=""></span><span class="token number">2</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">              views </span><span class="token operator">=</span><span class=""> metadataElements</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">              publishTime </span><span class="token operator">=</span><span class=""> metadataElements</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">videoId </span><span class="token operator">&&</span><span class=""> title</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">              results</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">                videoId</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">                title</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">                thumbnail</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">                channelId</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">                channelTitle</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">                views</span><span class="token punctuation">,</span><span class="">
</span></span><span class="">                publishTime
</span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 개별 아이템 처리 오류 무시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> results</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 비디오별 상세 정보 수집</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videoDetails </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> video </span><span class="token keyword">of</span><span class=""> videos</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class=""> maxResults</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 비디오 페이지 방문</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.youtube.com/watch?v=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">video</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">videoId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">waitUntil</span><span class="token operator">:</span><span class=""></span><span class="token string">'domcontentloaded'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'#info-contents'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class=""></span><span class="token number">5000</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token comment">// 추가 정보 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> details </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 좋아요 수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> likeElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#top-level-buttons-computed ytd-toggle-button-renderer:first-child #text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> likes </span><span class="token operator">=</span><span class=""> likeElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 영상 설명</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> descriptionElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#description-inline-expander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> description </span><span class="token operator">=</span><span class=""> descriptionElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 영상 길이</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> durationElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ytp-time-duration'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> duration </span><span class="token operator">=</span><span class=""> durationElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">{</span><span class=""> likes</span><span class="token punctuation">,</span><span class=""> description</span><span class="token punctuation">,</span><span class=""> duration </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token comment">// 채널 페이지 방문</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.youtube.com/channel/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">video</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">channelId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">waitUntil</span><span class="token operator">:</span><span class=""></span><span class="token string">'domcontentloaded'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'#channel-header'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class=""></span><span class="token number">5000</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token comment">// 채널 정보 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelInfo </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 구독자 수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> subscriberElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#subscriber-count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> subscribers </span><span class="token operator">=</span><span class=""> subscriberElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 채널 설명</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelDescElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#description-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> channelDescription </span><span class="token operator">=</span><span class=""> channelDescElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 총 동영상 수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videosTabElement </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#tabsContent tp-yt-paper-tab:nth-child(2) div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> totalVideosText </span><span class="token operator">=</span><span class=""> videosTabElement</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">''</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">{</span><span class=""> subscribers</span><span class="token punctuation">,</span><span class=""> channelDescription</span><span class="token punctuation">,</span><span class=""> totalVideosText </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token comment">// 종합 정보 저장</span><span class="">
</span></span><span class=""><span class="">          videoDetails</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">video</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">details</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">channelInfo</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">subscribers</span><span class="token operator">:</span><span class=""> channelInfo</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">,</span><span class="">
</span></span><span class="">          
</span><span class=""><span class=""></span><span class="token comment">// 뷰트랩 서비스에서 사용하는 계산 지수 추가</span><span class="">
</span></span><span class=""><span class="">            round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 완료</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">비디오 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">video</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">videoId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> 상세 정보 수집 오류:</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> e</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// MongoDB에 데이터 저장</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">videoDetails</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 계산된 지수 추가</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> processedVideos </span><span class="token operator">=</span><span class=""> videoDetails</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">video</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 조회수 문자열을 숫자로 변환 (예: "1.2만회" -> 12000)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> viewCount </span><span class="token operator">=</span><span class=""></span><span class="token function">parseViewCount</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">views</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> subscriberCount </span><span class="token operator">=</span><span class=""></span><span class="token function">parseSubscriberCount</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">subscribers</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token spread operator">...</span><span class="">video</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            viewCount</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            subscriberCount</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">hookIndex</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateHookIndex</span><span class="token punctuation">(</span><span class="">viewCount</span><span class="token punctuation">,</span><span class=""> subscriberCount</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">growthIndex</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateGrowthIndex</span><span class="token punctuation">(</span><span class="">viewCount</span><span class="token punctuation">,</span><span class=""> video</span><span class="token punctuation">.</span><span class="token property-access">publishTime</span><span class="token punctuation">,</span><span class=""> subscriberCount</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">exposureProbability</span><span class="token operator">:</span><span class=""></span><span class="token function">calculateExposureProbability</span><span class="token punctuation">(</span><span class="">viewCount</span><span class="token punctuation">,</span><span class=""> subscriberCount</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token comment">// 비디오 컬렉션에 데이터 저장</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="">processedVideos</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token comment">// KeywordHistory 상태 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 완료</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">video_count</span><span class="token operator">:</span><span class=""> processedVideos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">recKeywords</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">extractRelatedKeywords</span><span class="token punctuation">(</span><span class="">page</span><span class="token punctuation">,</span><span class=""> keyword</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'비디오 정보를 추출할 수 없습니다'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">YouTube 스크래핑 오류:</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">client</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 상태 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> db </span><span class="token operator">=</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'youtube_analytics'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 실패</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">error_message</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token literal-property property">update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">finally</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">browser</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> browser</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">client</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> client</span><span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 유틸리티 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">parseViewCount</span><span class="token punctuation">(</span><span class="token parameter">viewsStr</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">viewsStr</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// "조회수 1.2만회" -> 12000</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> cleaned </span><span class="token operator">=</span><span class=""> viewsStr</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">[^0-9.]</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation">,</span><span class=""></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">viewsStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'천'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">viewsStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'만'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">viewsStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'억'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">100000000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">parseSubscriberCount</span><span class="token punctuation">(</span><span class="token parameter">subscribersStr</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">subscribersStr</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// "구독자 123만명" -> 1230000</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> cleaned </span><span class="token operator">=</span><span class=""> subscribersStr</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">[^0-9.]</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation">,</span><span class=""></span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">subscribersStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'천'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">subscribersStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'만'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">subscribersStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'억'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">100000000</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">cleaned</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// dataMath3.md에 정의된 지수 계산 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">calculateHookIndex</span><span class="token punctuation">(</span><span class="token parameter">views</span><span class="token parameter punctuation">,</span><span class="token parameter"> subscribers</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">subscribers </span><span class="token operator">||</span><span class=""> subscribers </span><span class="token operator">===</span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'F'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> ratio </span><span class="token operator">=</span><span class=""> views </span><span class="token operator">/</span><span class=""> subscribers</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> hookIndex </span><span class="token operator">=</span><span class=""> ratio </span><span class="token operator">/</span><span class=""></span><span class="token number">8.3</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">hookIndex </span><span class="token operator">>=</span><span class=""></span><span class="token number">40</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'A'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">hookIndex </span><span class="token operator">>=</span><span class=""></span><span class="token number">20</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'B'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">hookIndex </span><span class="token operator">>=</span><span class=""></span><span class="token number">10</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'C'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">hookIndex </span><span class="token operator">>=</span><span class=""></span><span class="token number">5</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'D'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'F'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">calculateGrowthIndex</span><span class="token punctuation">(</span><span class="token parameter">views</span><span class="token parameter punctuation">,</span><span class="token parameter"> publishTimeStr</span><span class="token parameter punctuation">,</span><span class="token parameter"> subscribers</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 게시 시간 문자열 변환</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> daysSincePublish </span><span class="token operator">=</span><span class=""></span><span class="token function">parseDaysSincePublish</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 일평균 조회수 계산</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> viewsPerDay </span><span class="token operator">=</span><span class=""> views </span><span class="token operator">/</span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class=""> daysSincePublish</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 성장 지수 계산</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> growthValue </span><span class="token operator">=</span><span class=""> subscribers </span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class=""></span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">viewsPerDay </span><span class="token operator">/</span><span class=""> subscribers</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">1000</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">growthValue </span><span class="token operator">>=</span><span class=""></span><span class="token number">800</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'A'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">growthValue </span><span class="token operator">>=</span><span class=""></span><span class="token number">300</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'B'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">growthValue </span><span class="token operator">>=</span><span class=""></span><span class="token number">100</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'C'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">growthValue </span><span class="token operator">>=</span><span class=""></span><span class="token number">50</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'D'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'F'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">calculateExposureProbability</span><span class="token punctuation">(</span><span class="token parameter">views</span><span class="token parameter punctuation">,</span><span class="token parameter"> subscribers</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">subscribers </span><span class="token operator">||</span><span class=""> subscribers </span><span class="token operator">===</span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token number">0</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">views </span><span class="token operator">/</span><span class=""> subscribers</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">100</span><span class="token punctuation">,</span><span class=""></span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">parseDaysSincePublish</span><span class="token punctuation">(</span><span class="token parameter">publishTimeStr</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">publishTimeStr</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token number">30</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 기본값</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> now </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> days </span><span class="token operator">=</span><span class=""></span><span class="token number">30</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 기본값</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'년'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> years </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)년</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""> years </span><span class="token operator">*</span><span class=""></span><span class="token number">365</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'개월'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> months </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)개월</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""> months </span><span class="token operator">*</span><span class=""></span><span class="token number">30</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'주'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> weeks </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)주</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""> weeks </span><span class="token operator">*</span><span class=""></span><span class="token number">7</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'일'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)일</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'시간'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> hours </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)시간</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""> hours </span><span class="token operator">/</span><span class=""></span><span class="token number">24</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'분'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> minutes </span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">publishTimeStr</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(\d+)분</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    days </span><span class="token operator">=</span><span class=""> minutes </span><span class="token operator">/</span><span class=""></span><span class="token punctuation">(</span><span class="token number">24</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class=""> days</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">extractRelatedKeywords</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token parameter punctuation">,</span><span class="token parameter"> originalKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 검색 페이지로 돌아가기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.youtube.com/results?search_query=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">originalKeyword</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'#related-chip-bar, ytd-horizontal-card-list-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 관련 키워드 추출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> page</span><span class="token punctuation">.</span><span class="token method function property-access">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> chipItems </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'#related-chip-bar ytd-feed-chip-bar-renderer yt-chip-cloud-chip-renderer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> keywords </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class="">      chipItems</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> text </span><span class="token operator">=</span><span class=""> item</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#text'</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="">textContent</span><span class="token operator">?.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">text</span><span class="token punctuation">)</span><span class=""> keywords</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="">text</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> keywords</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'관련 키워드 추출 오류:'</span><span class="token punctuation">,</span><span class=""> e</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 서버 시작</span><span class="">
</span></span><span class=""><span class="">app</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 서비스가 포트 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation constant">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">에서 실행 중입니다</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></div></div></div></pre>

## 3. NextJS API 라우트 구현

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// pages/api/youtube/search/[keyword].ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token keyword">type</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/lib/mongodb'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">ObjectId</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'mongodb'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">handler</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class="">  req</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">  res</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">req</span><span class="token punctuation">.</span><span class="token property-access">method</span><span class=""></span><span class="token operator">!==</span><span class=""></span><span class="token string">'GET'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">,</span><span class=""> message</span><span class="token operator">:</span><span class=""></span><span class="token string">'허용되지 않는 메소드'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> uid </span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">'x-user-id'</span><span class="token punctuation">]</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">'anonymous'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> db </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 이미 검색된 키워드인지 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> existingKeyword </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">        uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 완료된 검색만</span><span class="">
</span></span><span class=""><span class="">        use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class=""></span><span class="token comment">// 활성 상태인 검색만 </span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        sort</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> update_dt</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token comment">// 가장 최근 검색 결과</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">existingKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 캐시된 데이터 반환</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">          keyword</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">          round_no</span><span class="token operator">:</span><span class=""> existingKeyword</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class="">          uid 
</span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">          videos</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          history</span><span class="token operator">:</span><span class=""> existingKeyword
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 진행 중인 검색이 있는지 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingKeyword </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">        uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 처리 중</span><span class="">
</span></span><span class=""><span class="">        use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">pendingKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 이미 처리 중인 경우</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">          history</span><span class="token operator">:</span><span class=""> pendingKeyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          message</span><span class="token operator">:</span><span class=""></span><span class="token string">'요청이 처리 중입니다. 잠시 후 다시 확인해주세요.'</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 새 검색 요청 생성</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> round_no </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> newKeyword </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      _id</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name maybe-class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      newKeyword</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      country</span><span class="token operator">:</span><span class=""></span><span class="token string">"KR"</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">      lang</span><span class="token operator">:</span><span class=""></span><span class="token string">"ko"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 처리 중</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      scheduler_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"N"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      video_tp</span><span class="token operator">:</span><span class=""></span><span class="token string">"02"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      level</span><span class="token operator">:</span><span class=""></span><span class="token number">1</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      create_user</span><span class="token operator">:</span><span class=""> uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      create_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      update_user</span><span class="token operator">:</span><span class=""> uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="">newKeyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// MongoDB Atlas 트리거가 나머지 처리를 담당</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">        history</span><span class="token operator">:</span><span class=""> newKeyword
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'API 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">      message</span><span class="token operator">:</span><span class=""></span><span class="token string">'서버 오류가 발생했습니다'</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## 4. 진행 상태 폴링 API 라우트

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// pages/api/youtube/status/[round_no].ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token keyword">type</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/lib/mongodb'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">handler</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class="">  req</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiRequest</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">  res</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextApiResponse</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">req</span><span class="token punctuation">.</span><span class="token property-access">method</span><span class=""></span><span class="token operator">!==</span><span class=""></span><span class="token string">'GET'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">,</span><span class=""> message</span><span class="token operator">:</span><span class=""></span><span class="token string">'허용되지 않는 메소드'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> round_no </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> uid </span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">'x-user-id'</span><span class="token punctuation">]</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">'anonymous'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> db </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 키워드 히스토리 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> keywordHistory </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> round_no</span><span class="token punctuation">,</span><span class=""> uid </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">keywordHistory</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        message</span><span class="token operator">:</span><span class=""></span><span class="token string">'요청을 찾을 수 없습니다'</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 상태가 완료된 경우 비디오 데이터 함께 반환</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">keywordHistory</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> round_no</span><span class="token punctuation">,</span><span class=""> uid </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">          videos</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          history</span><span class="token operator">:</span><span class=""> keywordHistory</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          complete</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 처리 중 또는 오류 상태</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">        history</span><span class="token operator">:</span><span class=""> keywordHistory</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        complete</span><span class="token operator">:</span><span class=""></span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        error</span><span class="token operator">:</span><span class=""> keywordHistory</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"2"</span><span class=""></span><span class="token operator">?</span><span class=""> keywordHistory</span><span class="token punctuation">.</span><span class="token property-access">error_message</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token keyword null nil">null</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'API 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">      message</span><span class="token operator">:</span><span class=""></span><span class="token string">'서버 오류가 발생했습니다'</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

# 사용자 경험 개선을 위한 프론트엔드 구현

이제 사용자 경험을 극대화할 수 있는 프론트엔드 구현 방법을 제시해 드리겠습니다.

## 1. 반응형 검색 페이지 구현 (React + TailwindCSS)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// pages/search.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useState</span><span class="token imports punctuation">,</span><span class="token imports"> useEffect </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useRouter </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next/router'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports">axios</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'axios'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">SearchBar</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/SearchBar'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">VideoGrid</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/VideoGrid'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">KeywordChips</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/KeywordChips'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">LoadingState</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/LoadingState'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">ErrorState</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/ErrorState'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">SearchPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> router </span><span class="token operator">=</span><span class=""></span><span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> router</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">loading</span><span class="token punctuation">,</span><span class=""> setLoading</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">polling</span><span class="token punctuation">,</span><span class=""> setPolling</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">error</span><span class="token punctuation">,</span><span class=""> setError</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">roundNo</span><span class="token punctuation">,</span><span class=""> setRoundNo</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">videos</span><span class="token punctuation">,</span><span class=""> setVideos</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">relatedKeywords</span><span class="token punctuation">,</span><span class=""> setRelatedKeywords</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 키워드로 검색 실행</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">keyword</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">fetchData</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/youtube/search/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword </span><span class="token template-string interpolation keyword module">as</span><span class="token template-string interpolation"></span><span class="token template-string interpolation builtin">string</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> history </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRoundNo</span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token comment">// 완료된 검색인 경우</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'1'</span><span class=""></span><span class="token operator">&&</span><span class=""> response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">videos</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setVideos</span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">videos</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRelatedKeywords</span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">recKeywords</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setPolling</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 처리 중인 경우 폴링 시작</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setPolling</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">err</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'검색 오류:'</span><span class="token punctuation">,</span><span class=""> err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">'검색 중 오류가 발생했습니다. 다시 시도해주세요.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">finally</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">[</span><span class="">keyword</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 폴링으로 처리 상태 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">polling </span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">roundNo</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pollInterval </span><span class="token operator">=</span><span class=""></span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/youtube/status/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">roundNo</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">      
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> history</span><span class="token punctuation">,</span><span class=""> videos</span><span class="token operator">:</span><span class=""> resultVideos</span><span class="token punctuation">,</span><span class=""> complete</span><span class="token punctuation">,</span><span class=""> error</span><span class="token operator">:</span><span class=""> resultError </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">        
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">complete</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 처리 완료</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setVideos</span><span class="token punctuation">(</span><span class="">resultVideos </span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRelatedKeywords</span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">recKeywords</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setPolling</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="">pollInterval</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'2'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 처리 실패</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setError</span><span class="token punctuation">(</span><span class="">resultError </span><span class="token operator">||</span><span class=""></span><span class="token string">'검색 처리 중 오류가 발생했습니다.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setPolling</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="">pollInterval</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">err</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'상태 확인 오류:'</span><span class="token punctuation">,</span><span class=""> err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class=""></span><span class="token comment">// 3초마다 확인</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="">pollInterval</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">[</span><span class="">polling</span><span class="token punctuation">,</span><span class=""> roundNo</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 관련 키워드 클릭 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleKeywordClick</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">keyword</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    router</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/search?keyword=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">container mx-auto px-4 py-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">SearchBar</span><span class="token tag"></span><span class="token tag attr-name">initialKeyword</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword </span><span class="token tag script language-javascript keyword module">as</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript builtin">string</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">loading </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">LoadingState</span><span class="token tag"></span><span class="token tag attr-name">message</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">검색 중입니다...</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""> error </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">ErrorState</span><span class="token tag"></span><span class="token tag attr-name">message</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">error</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""> polling </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">LoadingState</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">message</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">YouTube 데이터를 분석하고 있습니다</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">progress</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript boolean">true</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">description</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">이 과정은 약 30초에서 1분 정도 소요됩니다</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h1</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-2xl font-bold mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">              "{keyword}" 검색 결과
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">h1</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">relatedKeywords</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">KeywordChips</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">keywords</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">relatedKeywords</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onKeywordClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">handleKeywordClick</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">VideoGrid</span><span class="token tag"></span><span class="token tag attr-name">videos</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">videos</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## 2. 스켈레

Retry

Claude hit the max length for a message and has paused its response. You can write Continue to keep the chat going.

route

ts

route

ts

S

현재 라우트에 있는 ts파일들 먼저읽어봐야 너가 내 현재 코드에서 개선이 된 버전으로 반환해줄거같아

Edit

네, 제공해주신 두 개의 route.ts 파일을 살펴보았습니다. 이 파일들은 NextJS API 라우트로, YouTube 분석 서비스의 백엔드 로직을 처리하고 있군요.

첫 번째 파일은 `/api/v2/contents/videos` 라우트로 보이며, GET 요청을 처리하여 특정 round_no에 해당하는 비디오 정보와 키워드 히스토리를 조회합니다.

두 번째 파일은 `/api/v2/contents/videos/request/keyword` 라우트로 보이며, POST 요청을 처리하여 새로운 키워드 검색 요청을 생성합니다.

이제 이 코드를 기반으로 MongoDB Atlas의 트리거를 활용한 브라우저 스크래핑 솔루션을 제안하겠습니다. 기존 코드의 구조를 유지하면서 개선된 버전을 제공하겠습니다.

## 개선된 키워드 요청 라우트 (POST)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// app/api/v2/contents/videos/request/keyword/route.ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">NextRequest</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">NextResponse</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"next/server"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> getServerSession </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"next-auth/next"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/lib/db"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">KeywordHistory</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">User</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">MembershipLimit</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/models"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> authOptions </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/app/api/auth/[...nextauth]/route"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> triggerYouTubeScraping </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/lib/atlas-triggers"</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token constant">POST</span><span class="token punctuation">(</span><span class="">req</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextRequest</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> session </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">getServerSession</span><span class="token punctuation">(</span><span class="">authOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">session </span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"인증되지 않은 요청입니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">401</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> req</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">keyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"키워드를 입력해주세요."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">400</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 사용자 정보 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> user </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> uid</span><span class="token operator">:</span><span class=""> session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">user</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"사용자를 찾을 수 없습니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">404</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 이미 처리 중인 키워드인지 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingKeyword </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">pendingKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">            history</span><span class="token operator">:</span><span class=""> pendingKeyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            message</span><span class="token operator">:</span><span class=""></span><span class="token string">"이미 처리 중인 키워드입니다."</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 이미 완료된 최신 키워드인지 확인 (7일 이내)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> recentKeyword </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      update_dt</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> $gte</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">-</span><span class=""></span><span class="token number">7</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">24</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">60</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">60</span><span class=""></span><span class="token operator">*</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> update_dt</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">recentKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">            history</span><span class="token operator">:</span><span class=""> recentKeyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            message</span><span class="token operator">:</span><span class=""></span><span class="token string">"최근 검색된 키워드입니다."</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 멤버십 제한 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> membershipLimit </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">MembershipLimit</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      membership_level</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">membership_level</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">"free"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">membershipLimit</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> todayStart </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      todayStart</span><span class="token punctuation">.</span><span class="token method function property-access">setHours</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 오늘 사용한 검색 횟수 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> todaySearchCount </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        create_dt</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> $gte</span><span class="token operator">:</span><span class=""> todayStart </span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">todaySearchCount </span><span class="token operator">>=</span><span class=""> membershipLimit</span><span class="token punctuation">.</span><span class="token property-access">daily_search_limit</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">            error</span><span class="token operator">:</span><span class=""></span><span class="token string">"일일 검색 제한을 초과했습니다. 멤버십 업그레이드를 고려해보세요."</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">403</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 라운드 번호 생성</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> lastKeywordHistory </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> round_no</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> round_no </span><span class="token operator">=</span><span class=""> lastKeywordHistory 
</span></span><span class=""><span class=""></span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">lastKeywordHistory</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 키워드 히스토리 생성</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> newKeywordHistory </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      newKeyword</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      country</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">country</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">"KR"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      lang</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">lang</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">"ko"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      recKeywords</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      deletedKeywords</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class=""></span><span class="token comment">// 처리 중</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      use_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"Y"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      scheduler_yn</span><span class="token operator">:</span><span class=""></span><span class="token string">"N"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      video_tp</span><span class="token operator">:</span><span class=""></span><span class="token string">"02"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      level</span><span class="token operator">:</span><span class=""></span><span class="token number">1</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      create_user</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      create_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      update_user</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      update_dt</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 사용자의 알고리즘 사용 횟수 증가</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOneAndUpdate</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> $inc</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> algorithm_use_count</span><span class="token operator">:</span><span class=""></span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// MongoDB Atlas 트리거 실행 (또는 별도 처리 서비스 호출)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 이 부분은 Atlas 트리거가 자동으로 처리하거나, 수동으로 처리 서비스를 호출할 수 있습니다</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">triggerYouTubeScraping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        keywordId</span><span class="token operator">:</span><span class=""> newKeywordHistory</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        uid</span><span class="token operator">:</span><span class=""> user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">triggerError</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">"스크래핑 트리거 오류:"</span><span class="token punctuation">,</span><span class=""> triggerError</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류가 발생해도 사용자에게는 정상 응답 (백그라운드에서 재시도)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          history</span><span class="token operator">:</span><span class=""> newKeywordHistory</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token operator">:</span><span class=""></span><span class="token builtin">any</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">"키워드 검색 오류:"</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"키워드 검색 중 오류가 발생했습니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">500</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## 개선된 비디오 조회 라우트 (GET)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// app/api/v2/contents/videos/route.ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">NextRequest</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">NextResponse</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"next/server"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> getServerSession </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"next-auth/next"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/lib/db"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">KeywordHistory</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Video</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/models"</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> authOptions </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">"@/app/api/auth/[...nextauth]/route"</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="">req</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">NextRequest</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> session </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">getServerSession</span><span class="token punctuation">(</span><span class="">authOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">session </span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"인증되지 않은 요청입니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">401</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> url </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name constant">URL</span><span class="token punctuation">(</span><span class="">req</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> round_no </span><span class="token operator">=</span><span class=""> url</span><span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"round_no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">round_no</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"round_no 파라미터가 필요합니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">400</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 해당 라운드의 키워드 히스토리 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> history </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token operator">:</span><span class=""> session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">"keyword round_no status level _id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">history</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"해당 라운드의 키워드 히스토리를 찾을 수 없습니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">404</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 상태가 "0"(처리 중)인 경우 빈 비디오 배열 반환</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">            videos</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            history</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            filter</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            processingStatus</span><span class="token operator">:</span><span class=""></span><span class="token string">"pending"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 상태가 "2"(오류)인 경우 에러 정보 반환</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">            videos</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            history</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            filter</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            processingStatus</span><span class="token operator">:</span><span class=""></span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">            errorMessage</span><span class="token operator">:</span><span class=""></span><span class="token string">"데이터 수집 중 오류가 발생했습니다."</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 필터 파라미터 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> hookIndex </span><span class="token operator">=</span><span class=""> url</span><span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"hookIndex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> growthIndex </span><span class="token operator">=</span><span class=""> url</span><span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"growthIndex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> minViews </span><span class="token operator">=</span><span class=""> url</span><span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"minViews"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> maxViews </span><span class="token operator">=</span><span class=""> url</span><span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"maxViews"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> query</span><span class="token operator">:</span><span class=""></span><span class="token builtin">any</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token operator">:</span><span class=""> session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 필터 적용</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">hookIndex</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      query</span><span class="token punctuation">.</span><span class="token property-access">hookIndex</span><span class=""></span><span class="token operator">=</span><span class=""> hookIndex</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">growthIndex</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      query</span><span class="token punctuation">.</span><span class="token property-access">growthIndex</span><span class=""></span><span class="token operator">=</span><span class=""> growthIndex</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">minViews</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      query</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class=""> $gte</span><span class="token operator">:</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">minViews</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">maxViews</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">query</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        query</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class="token punctuation">.</span><span class="token property-access">$lte</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">maxViews</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        query</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class=""> $lte</span><span class="token operator">:</span><span class=""></span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="">maxViews</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 해당 라운드의 비디오 목록 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">Video</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="">query</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> viewCount</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 적용된 필터 정보</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> filter </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      hookIndex</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      growthIndex</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      minViews</span><span class="token punctuation">,</span><span class="">
</span></span><span class="">      maxViews
</span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        status</span><span class="token operator">:</span><span class=""></span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          videos</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          history</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          filter</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          processingStatus</span><span class="token operator">:</span><span class=""></span><span class="token string">"completed"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token operator">:</span><span class=""></span><span class="token builtin">any</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">"비디오 조회 오류:"</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> error</span><span class="token operator">:</span><span class=""></span><span class="token string">"비디오 조회 중 오류가 발생했습니다."</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">500</span><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## Atlas 트리거 호출 유틸리티

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// lib/atlas-triggers.ts</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports">axios</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'axios'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">ScrapingTriggerParams</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">  keywordId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  keyword</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  round_no</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  uid</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token doc-comment comment">/**
</span></span><span class=""> * YouTube 크롤링 트리거 함수
</span><span class=""> * Atlas 트리거가 자동으로 실행되지 않는 경우 수동으로 호출
</span><span class=""><span class="token doc-comment comment"> */</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">triggerYouTubeScraping</span><span class="token punctuation">(</span><span class="">params</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">ScrapingTriggerParams</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">Promise</span><span class="token operator"><</span><span class="token keyword">void</span><span class="token operator">></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 환경 변수에서 설정 불러오기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token constant">SCRAPING_SERVICE_URL</span><span class=""></span><span class="token operator">=</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SCRAPING_SERVICE_URL</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token constant">SCRAPING_SERVICE_API_KEY</span><span class=""></span><span class="token operator">=</span><span class=""> process</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SCRAPING_SERVICE_API_KEY</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">SCRAPING_SERVICE_URL</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token string">"SCRAPING_SERVICE_URL이 설정되지 않았습니다. Atlas 트리거에 의존합니다."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 스크래핑 서비스 호출</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token constant">SCRAPING_SERVICE_URL</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        task</span><span class="token operator">:</span><span class=""></span><span class="token string">"youtube_search"</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        params</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          keywordId</span><span class="token operator">:</span><span class=""> params</span><span class="token punctuation">.</span><span class="token property-access">keywordId</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          keyword</span><span class="token operator">:</span><span class=""> params</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          round_no</span><span class="token operator">:</span><span class=""> params</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          uid</span><span class="token operator">:</span><span class=""> params</span><span class="token punctuation">.</span><span class="token property-access">uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">          maxResults</span><span class="token operator">:</span><span class=""></span><span class="token number">20</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        headers</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span><span class=""></span><span class="token string">'application/json'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">'Authorization'</span><span class="token operator">:</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation constant">SCRAPING_SERVICE_API_KEY</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">!==</span><span class=""></span><span class="token number">202</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 서비스 응답 오류: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">response</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">status</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 작업 요청 성공: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">params</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> (Round: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">params</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">round_no</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">)</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'스크래핑 트리거 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""> error</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

## 프론트엔드 개선: 사용자 경험 극대화를 위한 구현

이제 사용자 경험을 개선하기 위한 프론트엔드 구현을 제안하겠습니다. 이는 전형적인 성공 사례를 기반으로 합니다.

### 1. 검색 컴포넌트 (React + Next.js)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/KeywordSearch.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string">'use client'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useState</span><span class="token imports punctuation">,</span><span class="token imports"> useEffect </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useRouter </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next/navigation'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports">axios</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'axios'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> toast </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react-hot-toast'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">Search</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Loader2</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">ArrowRight</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'lucide-react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">SkeletonLoader</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./SkeletonLoader'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">VideoCard</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./VideoCard'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">RelatedKeywordChips</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./RelatedKeywordChips'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">KeywordSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> router </span><span class="token operator">=</span><span class=""></span><span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">keyword</span><span class="token punctuation">,</span><span class=""> setKeyword</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">isSearching</span><span class="token punctuation">,</span><span class=""> setIsSearching</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">isPolling</span><span class="token punctuation">,</span><span class=""> setIsPolling</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">roundNo</span><span class="token punctuation">,</span><span class=""> setRoundNo</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">progress</span><span class="token punctuation">,</span><span class=""> setProgress</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">videos</span><span class="token punctuation">,</span><span class=""> setVideos</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">history</span><span class="token punctuation">,</span><span class=""> setHistory</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">relatedKeywords</span><span class="token punctuation">,</span><span class=""> setRelatedKeywords</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 폴링 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">pollResults</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">roundNo</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/v2/contents/videos?round_no=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">roundNo</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> data </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">processingStatus</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'completed'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 데이터 처리 완료</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setVideos</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">videos</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setHistory</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRelatedKeywords</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">.</span><span class="token property-access">recKeywords</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsPolling</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">        toast</span><span class="token punctuation">.</span><span class="token method function property-access">success</span><span class="token punctuation">(</span><span class="token string">'검색 결과가 준비되었습니다!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">processingStatus</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'error'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 발생</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsPolling</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">        toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">errorMessage</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">'데이터 처리 중 오류가 발생했습니다.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 진행 중인 경우 프로그레스 바 업데이트</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">prev</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span><span class="">prev </span><span class="token operator">+</span><span class=""></span><span class="token number">10</span><span class="token punctuation">,</span><span class=""></span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'폴링 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 폴링 오류가 발생해도 계속 시도</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 폴링 시작</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">isPolling</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> interval </span><span class="token operator">=</span><span class=""></span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="">pollResults</span><span class="token punctuation">,</span><span class=""></span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="">interval</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">[</span><span class="">isPolling</span><span class="token punctuation">,</span><span class=""> roundNo</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 검색 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleSearch</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    e</span><span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">keyword</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setVideos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRelatedKeywords</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 키워드 검색 요청</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/v2/contents/videos/request/keyword'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        keyword</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> data </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRoundNo</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setHistory</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// 이미 처리된 키워드인 경우</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'1'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 비디오 데이터 즉시 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videosResponse </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> axios</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/api/v2/contents/videos?round_no=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">history</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">round_no</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setVideos</span><span class="token punctuation">(</span><span class="">videosResponse</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">videos</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setRelatedKeywords</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">history</span><span class="token punctuation">.</span><span class="token property-access">recKeywords</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">        toast</span><span class="token punctuation">.</span><span class="token method function property-access">success</span><span class="token punctuation">(</span><span class="token string">'캐시된 검색 결과를 불러왔습니다.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 비동기 처리 시작</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsPolling</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">        toast</span><span class="token punctuation">.</span><span class="token method function property-access">loading</span><span class="token punctuation">(</span><span class="token string">'YouTube 데이터를 분석하고 있습니다...'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">          duration</span><span class="token operator">:</span><span class=""></span><span class="token number">5000</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token comment">// URL 업데이트 (히스토리에 기록)</span><span class="">
</span></span><span class=""><span class="">      router</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/search?keyword=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation method function property-access">trim</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&round=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">history</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">round_no</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'검색 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'검색 중 오류가 발생했습니다.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">finally</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 관련 키워드 클릭 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleRelatedKeywordClick</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">relatedKeyword</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setKeyword</span><span class="token punctuation">(</span><span class="">relatedKeyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 자동 검색 실행</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> form </span><span class="token operator">=</span><span class=""></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'search-form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">form</span><span class="token punctuation">)</span><span class=""> form</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class=""></span><span class="token class-name maybe-class-name">Event</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""> cancelable</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full max-w-6xl mx-auto px-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">form</span><span class="token tag"></span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">search-form</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag attr-name">onSubmit</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">handleSearch</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center border-2 border-blue-500 rounded-lg overflow-hidden shadow-lg</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">input</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onChange</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setKeyword</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">target</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">value</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full px-5 py-4 text-lg focus:outline-none</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">placeholder</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">분석할 YouTube 키워드를 입력하세요</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isSearching </span><span class="token tag script language-javascript operator">||</span><span class="token tag script language-javascript"> isPolling</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">submit</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">bg-blue-500 text-white px-6 py-4 h-full flex items-center </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation punctuation">(</span><span class="token tag script language-javascript template-string interpolation">isSearching </span><span class="token tag script language-javascript template-string interpolation operator">||</span><span class="token tag script language-javascript template-string interpolation"> isPolling</span><span class="token tag script language-javascript template-string interpolation punctuation">)</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'opacity-70 cursor-not-allowed'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'hover:bg-blue-600'</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isSearching </span><span class="token tag script language-javascript operator">||</span><span class="token tag script language-javascript"> isPolling</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isSearching </span><span class="token operator">||</span><span class=""> isPolling </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">Loader2</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-6 h-6 animate-spin</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">Search</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-6 h-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">ml-2 hidden sm:inline</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">분석</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">form</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isPolling </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-10 text-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full bg-gray-200 rounded-full h-2.5 mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">bg-blue-500 h-2.5 rounded-full transition-all duration-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> width</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">progress</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string string">%</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">YouTube 데이터를 분석 중입니다. 약 30초가 소요됩니다.</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">relatedKeywords</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h3</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-lg font-medium mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">관련 키워드</span><span class="token tag punctuation"></</span><span class="token tag">h3</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">RelatedKeywordChips</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">keywords</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">relatedKeywords</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onKeywordClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">handleRelatedKeywordClick</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isPolling </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 스켈레톤 로더 표시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">_</span><span class="token punctuation">,</span><span class=""> i</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">SkeletonLoader</span><span class="token tag"></span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">i</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""> videos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class=""></span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 비디오 결과 표시</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex justify-between items-center mb-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h2</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-2xl font-bold</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">분석 결과</span><span class="token tag punctuation"></</span><span class="token tag">h2</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">a</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">href</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">#detailed-analysis</span><span class="token tag attr-value punctuation">"</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-blue-500 hover:text-blue-700 flex items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">              상세 분석 보기
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">ArrowRight</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 ml-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">a</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">videos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">VideoCard</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">videoId</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">video</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token operator">!</span><span class="">isSearching </span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">isPolling </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 초기 상태 또는 결과 없음</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-center py-10</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">            키워드를 검색하여 YouTube 콘텐츠를 분석해보세요.
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 2. 비디오 카드 컴포넌트

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/VideoCard.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useState </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">Image</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next/image'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> formatDistanceToNow </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'date-fns'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> ko </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'date-fns/locale'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">Eye</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Users</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Clock</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">ThumbsUp</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Award</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">TrendingUp</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'lucide-react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">VideoCardProps</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">  video</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    videoId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    title</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    thumbnail</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    channelTitle</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    viewCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    subscriberCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    publishDate</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    duration</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    hookIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    growthIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    exposureProbability</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> formatNumber </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">num</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">10000000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'천만'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'만'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'천'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> num</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> getIndexColor </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">index</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">switch</span><span class=""></span><span class="token punctuation">(</span><span class="">index</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'A'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-green-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'B'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-blue-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'C'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-yellow-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'D'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-orange-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'F'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-red-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">default</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'bg-gray-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">VideoCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> video </span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">VideoCardProps</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">isHovered</span><span class="token punctuation">,</span><span class=""> setIsHovered</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> publishDate </span><span class="token operator">=</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Date</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">publishDate</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> timeAgo </span><span class="token operator">=</span><span class=""></span><span class="token function">formatDistanceToNow</span><span class="token punctuation">(</span><span class="">publishDate</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""> addSuffix</span><span class="token operator">:</span><span class=""></span><span class="token boolean">true</span><span class="token punctuation">,</span><span class=""> locale</span><span class="token operator">:</span><span class=""> ko </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onMouseEnter</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setIsHovered</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript boolean">true</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onMouseLeave</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setIsHovered</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript boolean">false</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">relative</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Image</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">thumbnail</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">alt</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">title</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">width</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript number">640</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">height</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript number">360</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full h-44 object-cover</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isHovered </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">a</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">href</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">https://www.youtube.com/watch?v=</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">videoId</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">target</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">_blank</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">rel</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">noopener noreferrer</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">absolute inset-0 flex items-center justify-center bg-black bg-opacity-50</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">bg-red-600 text-white rounded-full p-3</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">svg</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-10 h-10</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag attr-name">fill</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">currentColor</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag attr-name">viewBox</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">0 0 24 24</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">path</span><span class="token tag"></span><span class="token tag attr-name">d</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">M8 5v14l11-7z</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">svg</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">a</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">p-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h3</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-lg font-semibold mb-2 line-clamp-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">h3</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-600 mb-3</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">channelTitle</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex flex-wrap gap-2 mb-3</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center text-sm text-gray-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Eye</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="token function">formatNumber</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center text-sm text-gray-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Users</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="token function">formatNumber</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">subscriberCount</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center text-sm text-gray-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Clock</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">timeAgo</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">grid grid-cols-2 gap-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">border rounded p-2 text-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center justify-center mb-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Award</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">후킹 지수</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">text-white font-bold rounded-full w-8 h-8 flex items-center justify-center mx-auto </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation function">getIndexColor</span><span class="token tag script language-javascript template-string interpolation punctuation">(</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">hookIndex</span><span class="token tag script language-javascript template-string interpolation punctuation">)</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">hookIndex</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">border rounded p-2 text-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center justify-center mb-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">TrendingUp</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">성장 지수</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">text-white font-bold rounded-full w-8 h-8 flex items-center justify-center mx-auto </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation function">getIndexColor</span><span class="token tag script language-javascript template-string interpolation punctuation">(</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">growthIndex</span><span class="token tag script language-javascript template-string interpolation punctuation">)</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">growthIndex</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3. 스켈레톤 로더 컴포넌트

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/SkeletonLoader.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">SkeletonLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">bg-white rounded-lg shadow-md overflow-hidden animate-pulse</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full h-44 bg-gray-300</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">p-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-5 bg-gray-300 rounded w-3/4 mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-5 bg-gray-300 rounded w-1/2 mb-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex gap-2 mb-3</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-4 bg-gray-300 rounded w-16</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-4 bg-gray-300 rounded w-20</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">grid grid-cols-2 gap-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">border rounded p-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-4 bg-gray-300 rounded w-3/4 mx-auto mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-8 w-8 bg-gray-300 rounded-full mx-auto</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">border rounded p-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-4 bg-gray-300 rounded w-3/4 mx-auto mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-8 w-8 bg-gray-300 rounded-full mx-auto</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 4. 관련 키워드 칩 컴포넌트

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/RelatedKeywordChips.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">RelatedKeywordCh</span></span></code></div></div></div></pre>

Retry

Claude hit the max length for a message and has paused its response. You can write Continue to keep the chat going.

S

이어서 생성해.
next js와 vercel 을 이용해 배포할거고,
ai분석 결과 값을 반환할건데 ui컴포넌트는 코드 에디터 내의 코파일럿처럼 우측에 사이드바에서 각 탭에서 ai가 영상에 대한 분석을 해주는 거야. 검색결과는 라인형으로 제목, 썸네일, 후킹지수 성장지수, 구독자 수 영상플레이 시간 등이고 상세 분석기능이 영상을 클릭하면 사이드바가 추가로 열려서 스크립트추출과 재설계 역설계등을 포함한 ai마케팅 자동화 서비스를 해주는 건데, 내가 어려움을 겪었던 게 유즈 클라이언트를 이요하니까 보안정책때문인지 데이터 교환이 원활하지 않아 자꾸 에러가 뜨더라고. 그걸 고려해줘서 프론트와 백엔드를 개선해줘

Edit

사용자 경험을 개선하면서 NextJS와 Vercel 환경에 최적화된 클라이언트-서버 데이터 교환 구조로 개선해 드리겠습니다. 특히 useClient 사용 시 보안 정책 관련 문제를 해결하는 아키텍처를 제안하겠습니다.

# 개선된 YouTube 분석 서비스 아키텍처

## 1. 클라이언트-서버 데이터 교환 아키텍처

NextJS의 Server Components와 Client Components를 효과적으로 활용하여 보안 문제를 해결하는 구조를 설계하겠습니다.

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs"></div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code><span class=""><span class="">┌─────────────────────┐      ┌──────────────────┐
</span></span><span class="">│ Server Components   │      │ Client Components│
</span><span class="">│                     │      │                  │
</span><span class="">│ - 데이터 패칭       │      │ - 사용자 상호작용│
</span><span class="">│ - 인증 처리         │◄────►│ - UI 애니메이션  │
</span><span class="">│ - 초기 렌더링       │      │ - 상태 관리      │
</span><span class="">└─────────────────────┘      └──────────────────┘
</span><span class="">          ▲                            │
</span><span class="">          │                            │
</span><span class="">          │                            ▼
</span><span class="">┌─────────────────────┐      ┌──────────────────┐
</span><span class="">│ API Routes          │      │ Custom Hooks     │
</span><span class="">│                     │      │                  │
</span><span class="">│ - 데이터 CRUD       │◄────►│ - 데이터 캐싱    │
</span><span class="">│ - 외부 API 통신     │      │ - SWR/React Query│
</span><span class="">└─────────────────────┘      └──────────────────┘</span></code></div></div></div></pre>

이 아키텍처는 다음과 같은 이점을 제공합니다:

1. Server Components에서 민감한 데이터 처리
2. Client Components에서는 UI 상호작용에만 집중
3. API Routes를 통한 데이터 통신으로 CORS 및 보안 정책 문제 해결
4. SWR/React Query를 활용한 효율적인 데이터 캐싱

## 2. 핵심 파일 구조

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs"></div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code><span class=""><span class="">app/
</span></span><span class="">├── (auth)/
</span><span class="">│   └── login/
</span><span class="">│       └── page.tsx        # 로그인 페이지 (Server Component)
</span><span class="">├── (dashboard)/
</span><span class="">│   ├── search/
</span><span class="">│   │   └── page.tsx        # 검색 페이지 (Server Component)
</span><span class="">│   └── video/
</span><span class="">│       └── [videoId]/
</span><span class="">│           └── page.tsx    # 비디오 상세 페이지 (Server Component)
</span><span class="">├── api/
</span><span class="">│   ├── auth/
</span><span class="">│   │   └── [...nextauth]/
</span><span class="">│   │       └── route.ts   # 인증 API
</span><span class="">│   ├── youtube/
</span><span class="">│   │   ├── analysis/
</span><span class="">│   │   │   └── route.ts   # AI 분석 API
</span><span class="">│   │   ├── search/
</span><span class="">│   │   │   └── route.ts   # 검색 API
</span><span class="">│   │   └── video/
</span><span class="">│   │       └── [videoId]/
</span><span class="">│   │           └── route.ts # 비디오 상세 API
</span><span class="">│   └── scraping/
</span><span class="">│       └── route.ts       # 스크래핑 처리 API
</span><span class="">├── components/
</span><span class="">│   ├── client/           # Client Components
</span><span class="">│   │   ├── SearchBar.tsx
</span><span class="">│   │   ├── VideoList.tsx
</span><span class="">│   │   ├── VideoCard.tsx
</span><span class="">│   │   ├── AnalysisSidebar.tsx
</span><span class="">│   │   └── ScriptGenerator.tsx
</span><span class="">│   └── server/           # Server Components
</span><span class="">│       ├── VideoContent.tsx
</span><span class="">│       └── SearchResults.tsx
</span><span class="">├── lib/
</span><span class="">│   ├── db.ts             # MongoDB 연결
</span><span class="">│   ├── auth.ts           # 인증 유틸리티
</span><span class="">│   ├── api-handlers.ts   # API 요청 핸들러
</span><span class="">│   └── youtube-scraper.ts # 스크래핑 로직
</span><span class="">└── hooks/
</span><span class="">    ├── useSearch.ts      # 검색 기능 Hook
</span><span class="">    ├── useAnalysis.ts    # AI 분석 기능 Hook
</span><span class="">    └── useVideoData.ts   # 비디오 데이터 Hook</span></code></div></div></div></pre>

## 3. 개선된 코드 구현

### 3.1 서버 컴포넌트 (검색 페이지)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// app/(dashboard)/search/page.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">Suspense</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">SearchBar</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/client/SearchBar'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">SearchResults</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/server/SearchResults'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> getServerSession </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next-auth/next'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> redirect </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next/navigation'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> authOptions </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/app/api/auth/[...nextauth]/route'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports maybe-class-name">LoadingSpinner</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/client/LoadingSpinner'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 검색 페이지의 서버 컴포넌트 (서버에서 렌더링됨)</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">SearchPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class="">  searchParams 
</span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">  searchParams</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token operator">?</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class=""> round_no</span><span class="token operator">?</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token punctuation">}</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 서버에서 인증 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> session </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">getServerSession</span><span class="token punctuation">(</span><span class="">authOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">session </span><span class="token operator">||</span><span class=""></span><span class="token operator">!</span><span class="">session</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 인증되지 않은 경우 로그인 페이지로 리디렉션</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token punctuation">,</span><span class=""> round_no </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> searchParams</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex flex-col min-h-screen</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">main</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex-grow</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">max-w-7xl mx-auto px-4 py-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 클라이언트 컴포넌트 (사용자 상호작용) */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">SearchBar</span><span class="token tag"></span><span class="token tag attr-name">initialKeyword</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword </span><span class="token tag script language-javascript operator">||</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">''</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 서버 컴포넌트 (데이터 로딩) */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Suspense</span><span class="token tag"></span><span class="token tag attr-name">fallback</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation"><</span><span class="token tag script language-javascript class-name">LoadingSpinner</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">/></span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">keyword </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">SearchResults</span><span class="token tag"></span><span class="token tag attr-name">keyword</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag attr-name">round_no</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">round_no</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag attr-name">uid</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">session</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">user</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">uid</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag class-name">Suspense</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">main</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3.2 서버 컴포넌트 (검색 결과)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/server/SearchResults.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">VideoList</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/client/VideoList'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> connectToDatabase </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/lib/db'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">KeywordHistory</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Video</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/models'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">AnalysisProgress</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/components/client/AnalysisProgress'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 서버 컴포넌트는 'use client'를 사용하지 않음</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">  keyword</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class=""><span class="">  round_no</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="">  uid 
</span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class=""><span class="">  keyword</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class=""> 
</span></span><span class=""><span class="">  round_no</span><span class="token operator">?</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class=""> 
</span></span><span class=""><span class="">  uid</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""> 
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 서버에서 직접 데이터베이스 연결</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">connectToDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 최신 검색 히스토리 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> history</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">round_no</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 특정 라운드의 검색 결과 조회</span><span class="">
</span></span><span class=""><span class="">    history </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 해당 키워드의 최신 검색 결과 조회</span><span class="">
</span></span><span class=""><span class="">    history </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">KeywordHistory</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">      uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> create_dt</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">history</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 이전 검색 기록이 없는 경우 - 초기 상태</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mt-8 text-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">          키워드 "{keyword}"에 대한 검색 기록이 없습니다.
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 프로세싱 상태 확인</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 진행 중인 검색</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mt-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">AnalysisProgress</span><span class="token tag"></span><span class="token tag attr-name">keyword</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag attr-name">roundNo</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">history</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">round_no</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">history</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// 오류 발생</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mt-8 text-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">p-4 bg-red-50 text-red-700 rounded-lg</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">font-medium</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">처리 중 오류가 발생했습니다</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-sm mt-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">다시 시도해주세요</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 비디오 목록 조회</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> videos </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token maybe-class-name">Video</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    round_no</span><span class="token operator">:</span><span class=""> history</span><span class="token punctuation">.</span><span class="token property-access">round_no</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">    uid</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> viewCount</span><span class="token operator">:</span><span class=""></span><span class="token operator">-</span><span class="token number">1</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 관련 키워드</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> relatedKeywords </span><span class="token operator">=</span><span class=""> history</span><span class="token punctuation">.</span><span class="token property-access">recKeywords</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 클라이언트 컴포넌트에 props 전달</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mt-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">VideoList</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">videos</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript known-class-name class-name">JSON</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript method function property-access">parse</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript known-class-name class-name">JSON</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript method function property-access">stringify</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">videos</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">relatedKeywords</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">relatedKeywords</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">historyId</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">history</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">_id</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript method function property-access">toString</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">roundNo</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">history</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">round_no</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3.3 클라이언트 컴포넌트 (검색 바)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/client/SearchBar.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string">'use client'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useState </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useRouter </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'next/navigation'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">Search</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Loader2</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'lucide-react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> toast </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react-hot-toast'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">SearchBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> initialKeyword </span><span class="token operator">=</span><span class=""></span><span class="token string">''</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> router </span><span class="token operator">=</span><span class=""></span><span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">keyword</span><span class="token punctuation">,</span><span class=""> setKeyword</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="">initialKeyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">isSearching</span><span class="token punctuation">,</span><span class=""> setIsSearching</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleSearch</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token punctuation">(</span><span class="">e</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">FormEvent</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    e</span><span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">keyword</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class=""></span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// API Route를 통한 검색 요청</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> response </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/youtube/search'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        method</span><span class="token operator">:</span><span class=""></span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        headers</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span><span class=""></span><span class="token string">'application/json'</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class="">        body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> keyword</span><span class="token operator">:</span><span class=""> keyword</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="">response</span><span class="token punctuation">.</span><span class="token property-access">ok</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">throw</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name known-class-name">Error</span><span class="token punctuation">(</span><span class="token string">'검색 요청 실패'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> data </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> response</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">    
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">status</span><span class=""></span><span class="token operator">===</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token comment">// URL 파라미터로 검색 결과 페이지로 이동</span><span class="">
</span></span><span class=""><span class="">        router</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/search?keyword=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&round_no=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">data</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">history</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">round_no</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">        toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="">data</span><span class="token punctuation">.</span><span class="token property-access">error</span><span class=""></span><span class="token operator">||</span><span class=""></span><span class="token string">'검색 처리 중 오류가 발생했습니다'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'검색 오류:'</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'검색 중 오류가 발생했습니다'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">finally</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">form</span><span class="token tag"></span><span class="token tag attr-name">onSubmit</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">handleSearch</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center border-2 border-blue-500 rounded-lg overflow-hidden shadow-lg</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">input</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">keyword</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onChange</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setKeyword</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">target</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">value</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full px-5 py-4 text-lg focus:outline-none</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">placeholder</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">분석할 YouTube 키워드를 입력하세요</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isSearching</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">submit</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">bg-blue-500 text-white px-6 py-4 h-full flex items-center </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation">            isSearching </span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'opacity-70 cursor-not-allowed'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'hover:bg-blue-600'</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isSearching</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isSearching </span><span class="token operator">?</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">Loader2</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-6 h-6 animate-spin</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class=""></span><span class="token operator">:</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">Search</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-6 h-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">ml-2 hidden sm:inline</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">분석</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">form</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3.4 클라이언트 컴포넌트 (비디오 목록)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/client/VideoList.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string">'use client'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation">,</span><span class="token imports"> useState </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">VideoCard</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./VideoCard'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">AnalysisSidebar</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./AnalysisSidebar'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">VideoAnalysisStatus</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'./VideoAnalysisStatus'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">Video</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">  _id</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  videoId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  title</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  thumbnail</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  channelTitle</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  channelId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  viewCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  subscriberCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  duration</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  publishDate</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  hookIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  growthIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  exposureProbability</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">VideoListProps</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">  videos</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">Video</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  relatedKeywords</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  historyId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  roundNo</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">VideoList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> videos</span><span class="token punctuation">,</span><span class=""> relatedKeywords</span><span class="token punctuation">,</span><span class=""> historyId</span><span class="token punctuation">,</span><span class=""> roundNo </span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">VideoListProps</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">selectedVideo</span><span class="token punctuation">,</span><span class=""> setSelectedVideo</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token generic-function function">useState</span><span class="token generic-function generic class-name operator"><</span><span class="token generic-function generic class-name maybe-class-name">Video</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name keyword null nil">null</span><span class="token generic-function generic class-name operator">></span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">isSidebarOpen</span><span class="token punctuation">,</span><span class=""> setIsSidebarOpen</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">sortBy</span><span class="token punctuation">,</span><span class=""> setSortBy</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token generic-function function">useState</span><span class="token generic-function generic class-name operator"><</span><span class="token generic-function generic class-name string">'viewCount'</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name string">'hookIndex'</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name string">'growthIndex'</span><span class="token generic-function generic class-name operator">></span><span class="token punctuation">(</span><span class="token string">'viewCount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">filteredVideos</span><span class="token punctuation">,</span><span class=""> setFilteredVideos</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token generic-function function">useState</span><span class="token generic-function generic class-name operator"><</span><span class="token generic-function generic class-name maybe-class-name">Video</span><span class="token generic-function generic class-name punctuation">[</span><span class="token generic-function generic class-name punctuation">]</span><span class="token generic-function generic class-name operator">></span><span class="token punctuation">(</span><span class="">videos</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 정렬 및 필터 적용</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">let</span><span class=""> sorted </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="">videos</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">sortBy </span><span class="token operator">===</span><span class=""></span><span class="token string">'viewCount'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">      sorted</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">a</span><span class="token punctuation">,</span><span class=""> b</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""> b</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class=""></span><span class="token operator">-</span><span class=""> a</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">sortBy </span><span class="token operator">===</span><span class=""></span><span class="token string">'hookIndex'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> indexOrder </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token string-property property">'A'</span><span class="token operator">:</span><span class=""></span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'B'</span><span class="token operator">:</span><span class=""></span><span class="token number">1</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'C'</span><span class="token operator">:</span><span class=""></span><span class="token number">2</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'D'</span><span class="token operator">:</span><span class=""></span><span class="token number">3</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'F'</span><span class="token operator">:</span><span class=""></span><span class="token number">4</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      sorted</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">a</span><span class="token punctuation">,</span><span class=""> b</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""> indexOrder</span><span class="token punctuation">[</span><span class="">a</span><span class="token punctuation">.</span><span class="token property-access">hookIndex</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token keyword">keyof</span><span class=""></span><span class="token keyword">typeof</span><span class=""> indexOrder</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">-</span><span class=""> indexOrder</span><span class="token punctuation">[</span><span class="">b</span><span class="token punctuation">.</span><span class="token property-access">hookIndex</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token keyword">keyof</span><span class=""></span><span class="token keyword">typeof</span><span class=""> indexOrder</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">sortBy </span><span class="token operator">===</span><span class=""></span><span class="token string">'growthIndex'</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> indexOrder </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token string-property property">'A'</span><span class="token operator">:</span><span class=""></span><span class="token number">0</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'B'</span><span class="token operator">:</span><span class=""></span><span class="token number">1</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'C'</span><span class="token operator">:</span><span class=""></span><span class="token number">2</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'D'</span><span class="token operator">:</span><span class=""></span><span class="token number">3</span><span class="token punctuation">,</span><span class=""></span><span class="token string-property property">'F'</span><span class="token operator">:</span><span class=""></span><span class="token number">4</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">      sorted</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">a</span><span class="token punctuation">,</span><span class=""> b</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""> indexOrder</span><span class="token punctuation">[</span><span class="">a</span><span class="token punctuation">.</span><span class="token property-access">growthIndex</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token keyword">keyof</span><span class=""></span><span class="token keyword">typeof</span><span class=""> indexOrder</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">-</span><span class=""> indexOrder</span><span class="token punctuation">[</span><span class="">b</span><span class="token punctuation">.</span><span class="token property-access">growthIndex</span><span class=""></span><span class="token keyword module">as</span><span class=""></span><span class="token keyword">keyof</span><span class=""></span><span class="token keyword">typeof</span><span class=""> indexOrder</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token function">setFilteredVideos</span><span class="token punctuation">(</span><span class="">sorted</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">[</span><span class="">videos</span><span class="token punctuation">,</span><span class=""> sortBy</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 비디오 선택 처리</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleVideoSelect</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">video</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">Video</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setSelectedVideo</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsSidebarOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token comment">// 사이드바 닫기</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">handleCloseSidebar</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function">setIsSidebarOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">  
</span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">relative flex</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 메인 콘텐츠 영역 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex-1 transition-all </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">isSidebarOpen </span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'mr-96'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'mr-0'</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 필터 및 정렬 컨트롤 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-6 flex flex-wrap gap-4 items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h2</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-2xl font-bold</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">검색 결과</span><span class="token tag punctuation"></</span><span class="token tag">h2</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-500 text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">videos</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">}</span><span class="token plain-text">개의 영상을 분석했습니다</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex gap-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">select</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">sortBy</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onChange</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setSortBy</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">e</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">target</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">value</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword module">as</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'viewCount'</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript operator">|</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'hookIndex'</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript operator">|</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'growthIndex'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">border rounded p-2 text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">option</span><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">viewCount</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">조회수 순</span><span class="token tag punctuation"></</span><span class="token tag">option</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">option</span><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">hookIndex</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">후킹 지수 순</span><span class="token tag punctuation"></</span><span class="token tag">option</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">option</span><span class="token tag"></span><span class="token tag attr-name">value</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">growthIndex</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">성장 지수 순</span><span class="token tag punctuation"></</span><span class="token tag">option</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">select</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 관련 키워드 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">relatedKeywords</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class=""></span><span class="token operator">></span><span class=""></span><span class="token number">0</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mb-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h3</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-lg font-medium mb-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">관련 키워드</span><span class="token tag punctuation"></</span><span class="token tag">h3</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex flex-wrap gap-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">relatedKeywords</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">keyword</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="">              
</span><span class=""><span class="">                  key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="">keyword</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class="">                  href</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/search?keyword=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation function">encodeURIComponent</span><span class="token template-string interpolation punctuation">(</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation punctuation">)</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class="">                  className</span><span class="token operator">=</span><span class="token string">"bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm hover:bg-blue-100 transition-colors"</span><span class="">
</span></span><span class=""><span class=""></span><span class="token operator">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class="">keyword</span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"></</span><span class="token tag">a</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 비디오 목록 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">space-y-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">filteredVideos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">VideoCard</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">videoId</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">video</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">handleVideoSelect</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">isSelected</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">selectedVideo</span><span class="token tag script language-javascript operator">?.</span><span class="token tag script language-javascript">videoId </span><span class="token tag script language-javascript operator">===</span><span class="token tag script language-javascript"> video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">videoId</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 분석 사이드바 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">fixed right-0 top-0 h-full w-96 bg-white shadow-xl border-l overflow-y-auto transition-transform </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation">          isSidebarOpen </span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'translate-x-0'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'translate-x-full'</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> zIndex</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript number">40</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">selectedVideo </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag class-name">AnalysisSidebar</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">video</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">selectedVideo</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onClose</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">handleCloseSidebar</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">roundNo</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">roundNo</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3.5 비디오 카드 컴포넌트 (라인형)

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class=""><span class="token comment">// components/client/VideoCard.tsx</span><span class="">
</span></span><span class=""><span class=""></span><span class="token string">'use client'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"></span><span class="token imports maybe-class-name">Eye</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Users</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Clock</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">Award</span><span class="token imports punctuation">,</span><span class="token imports"></span><span class="token imports maybe-class-name">TrendingUp</span><span class="token imports"></span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'lucide-react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">VideoCardProps</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">  video</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class="">    videoId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    title</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    thumbnail</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    channelTitle</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    viewCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    subscriberCount</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    duration</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    publishDate</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    hookIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">    growthIndex</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token function-variable function">onClick</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class="">  isSelected</span><span class="token operator">:</span><span class=""></span><span class="token builtin">boolean</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 숫자 포맷 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> formatNumber </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">num</span><span class="token operator">:</span><span class=""></span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">10000000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'천만'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'만'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">>=</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">num </span><span class="token operator">/</span><span class=""></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class=""></span><span class="token operator">+</span><span class=""></span><span class="token string">'천'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> num</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token comment">// 인덱스 색상 함수</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> getIndexColor </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">index</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">switch</span><span class=""></span><span class="token punctuation">(</span><span class="">index</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'A'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-green-500 border-green-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'B'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-blue-500 border-blue-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'C'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-yellow-500 border-yellow-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'D'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-orange-500 border-orange-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword">case</span><span class=""></span><span class="token string">'F'</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-red-500 border-red-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword module">default</span><span class="token operator">:</span><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token string">'text-gray-500 border-gray-500'</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="">
</span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">VideoCard</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> video</span><span class="token punctuation">,</span><span class=""> onClick</span><span class="token punctuation">,</span><span class=""> isSelected </span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">VideoCardProps</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class=""><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex gap-4 p-4 border rounded-lg cursor-pointer hover:shadow-md transition-shadow </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation">        isSelected </span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'border-blue-500 bg-blue-50'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'border-gray-200'</span><span class="token tag script language-javascript template-string interpolation">
</span></span><span class=""><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">onClick</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 썸네일 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">relative w-64 h-36 flex-shrink-0</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">img</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">thumbnail</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">alt</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">title</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full h-full object-cover rounded</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class=""><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-1.5 py-0.5 rounded</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 콘텐츠 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex-1 flex flex-col justify-between</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h3</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">font-medium text-lg mb-1 line-clamp-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">h3</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-600 text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">channelTitle</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">      
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex flex-wrap items-center gap-x-4 gap-y-2 mt-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 조회수 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center text-sm text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Eye</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="token function">formatNumber</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">viewCount</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 구독자 수 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center text-sm text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Users</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="token function">formatNumber</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">subscriberCount</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 후킹 지수 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Award</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1 text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">text-sm font-medium border rounded-full w-6 h-6 flex items-center justify-center </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation function">getIndexColor</span><span class="token tag script language-javascript template-string interpolation punctuation">(</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">hookIndex</span><span class="token tag script language-javascript template-string interpolation punctuation">)</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">hookIndex</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">        
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 성장 지수 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">TrendingUp</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 mr-1 text-gray-600</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">span</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">text-sm font-medium border rounded-full w-6 h-6 flex items-center justify-center </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation function">getIndexColor</span><span class="token tag script language-javascript template-string interpolation punctuation">(</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">growthIndex</span><span class="token tag script language-javascript template-string interpolation punctuation">)</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">growthIndex</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">span</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">    
</span><span class=""><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 우측 버튼 영역 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-blue-500 font-medium text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="">          상세 분석
</span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class=""><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

### 3.6 분석 사이드바 컴포넌트

<pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">tsx</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-tsx"><span class="token plain-text"><span class="token comment">// components/client/AnalysisSidebar.tsx</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token string">'use client'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useState</span><span class="token imports punctuation">,</span><span class="token imports"> useEffect </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token punctuation">{</span><span class=""></span><span class="token constant">X</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">Play</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">PauseCircle</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">Code</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">FileText</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">BarChart2</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">MessageSquare</span><span class="token punctuation">,</span><span class=""></span><span class="token maybe-class-name">Copy</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'lucide-react'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> toast </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'react-hot-toast'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword module">import</span><span class=""></span><span class="token imports punctuation">{</span><span class="token imports"> useAnalysis </span><span class="token imports punctuation">}</span><span class=""></span><span class="token keyword module">from</span><span class=""></span><span class="token string">'@/hooks/useAnalysis'</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token keyword">interface</span><span class=""></span><span class="token class-name maybe-class-name">AnalysisSidebarProps</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class="">  video</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class="">    videoId</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class="">    title</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class="">    thumbnail</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class="">    channelTitle</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function-variable function">onClose</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token keyword">void</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class="">  roundNo</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function maybe-class-name">AnalysisSidebar</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> video</span><span class="token punctuation">,</span><span class=""> onClose</span><span class="token punctuation">,</span><span class=""> roundNo </span><span class="token punctuation">}</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">AnalysisSidebarProps</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">[</span><span class="">activeTab</span><span class="token punctuation">,</span><span class=""> setActiveTab</span><span class="token punctuation">]</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token generic-function function">useState</span><span class="token generic-function generic class-name operator"><</span><span class="token generic-function generic class-name string">'script'</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name string">'analysis'</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name string">'thumbnail'</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">|</span><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name string">'redesign'</span><span class="token generic-function generic class-name operator">></span><span class="token punctuation">(</span><span class="token string">'analysis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">  
</span><span class="token plain-text"><span class=""></span><span class="token comment">// 분석 데이터 Hook 사용</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    data</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    isLoading</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    error</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    generateScript</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    generateAnalysis</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text"><span class="">    generateThumbnail</span><span class="token punctuation">,</span><span class=""> 
</span></span><span class="token plain-text">    generateRedesign 
</span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token function">useAnalysis</span><span class="token punctuation">(</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class="token punctuation">,</span><span class=""> roundNo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token comment">// 탭 변경 시 필요한 데이터 생성</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">activeTab </span><span class="token operator">===</span><span class=""></span><span class="token string">'script'</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">data</span><span class="token operator">?.</span><span class="">script</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function">generateScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">activeTab </span><span class="token operator">===</span><span class=""></span><span class="token string">'analysis'</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">data</span><span class="token operator">?.</span><span class="">analysis</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function">generateAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">activeTab </span><span class="token operator">===</span><span class=""></span><span class="token string">'thumbnail'</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">data</span><span class="token operator">?.</span><span class="">thumbnail</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function">generateThumbnail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">else</span><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">activeTab </span><span class="token operator">===</span><span class=""></span><span class="token string">'redesign'</span><span class=""></span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">data</span><span class="token operator">?.</span><span class="">redesign</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token function">generateRedesign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">[</span><span class="">activeTab</span><span class="token punctuation">,</span><span class=""> data</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token comment">// 클립보드 복사 함수</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token function-variable function">copyToClipboard</span><span class=""></span><span class="token operator">=</span><span class=""></span><span class="token punctuation">(</span><span class="">text</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">,</span><span class=""> label</span><span class="token operator">:</span><span class=""></span><span class="token builtin">string</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">clipboard</span><span class="token punctuation">.</span><span class="token method function property-access">writeText</span><span class="token punctuation">(</span><span class="">text</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class="">      toast</span><span class="token punctuation">.</span><span class="token method function property-access">success</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">label</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> 복사 완료!</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class=""></span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">{</span><span class="">
</span></span><span class="token plain-text"><span class="">      toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'복사에 실패했습니다'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
</span></span><span class="token plain-text">
</span><span class="token plain-text"><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">h-full flex flex-col bg-white</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 헤더 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">p-4 border-b flex justify-between items-center</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h3</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">font-semibold</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">콘텐츠 분석</span><span class="token tag punctuation"></</span><span class="token tag">h3</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">onClose</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-gray-500 hover:text-gray-700</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">X</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-5 h-5</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text">    
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 비디오 미리보기 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">p-4 border-b</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">relative aspect-video mb-3</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">img</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">thumbnail</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">alt</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">video</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript property-access">title</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-full h-full object-cover rounded</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">a</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">href</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">https://www.youtube.com/watch?v=</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">video</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">videoId</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">target</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">_blank</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">rel</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">noopener noreferrer</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 group</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">bg-red-600 text-white rounded-full p-2 group-hover:scale-110 transition-transform</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Play</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-6 h-6</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">a</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">h4</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">font-medium line-clamp-2</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">h4</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-sm text-gray-600 mt-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token punctuation">{</span><span class="">video</span><span class="token punctuation">.</span><span class="token property-access">channelTitle</span><span class="token punctuation">}</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text">    
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 탭 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex border-b</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex-1 py-2 text-sm font-medium </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">activeTab </span><span class="token tag script language-javascript template-string interpolation operator">===</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'analysis'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-blue-600 border-b-2 border-blue-600'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-gray-600'</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setActiveTab</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">'analysis'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">BarChart2</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 inline-block mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text">          콘텐츠 분석
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex-1 py-2 text-sm font-medium </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">activeTab </span><span class="token tag script language-javascript template-string interpolation operator">===</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'script'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-blue-600 border-b-2 border-blue-600'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-gray-600'</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setActiveTab</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">'script'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">FileText</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 inline-block mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text">          스크립트
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex-1 py-2 text-sm font-medium </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">activeTab </span><span class="token tag script language-javascript template-string interpolation operator">===</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'redesign'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-blue-600 border-b-2 border-blue-600'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-gray-600'</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setActiveTab</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">'redesign'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">Code</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 inline-block mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text">          역설계
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">flex-1 py-2 text-sm font-medium </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">activeTab </span><span class="token tag script language-javascript template-string interpolation operator">===</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'thumbnail'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">?</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-blue-600 border-b-2 border-blue-600'</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation operator">:</span><span class="token tag script language-javascript template-string interpolation"></span><span class="token tag script language-javascript template-string interpolation string">'text-gray-600'</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">setActiveTab</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">'thumbnail'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag class-name">MessageSquare</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">w-4 h-4 inline-block mr-1</span><span class="token tag attr-value punctuation">"</span><span class="token tag"></span><span class="token tag punctuation">/></span><span class="token plain-text">
</span></span><span class="token plain-text">          썸네일
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text">    
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 콘텐츠 영역 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex-1 overflow-y-auto p-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">isLoading </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">flex items-center justify-center h-full</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text">      
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">error </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">text-center text-red-500 py-8</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">데이터를 불러오지 못했습니다</span><span class="token tag punctuation"></</span><span class="token tag">p</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"><</span><span class="token tag">button</span><span class="token tag"> 
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm</span><span class="token tag attr-value punctuation">"</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript arrow operator">=></span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">
</span></span><span class="token plain-text"><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">if</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">activeTab </span><span class="token tag script language-javascript operator">===</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'script'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">generateScript</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript">
</span></span><span class="token plain-text"><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">else</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">if</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">activeTab </span><span class="token tag script language-javascript operator">===</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'analysis'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">generateAnalysis</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript">
</span></span><span class="token plain-text"><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">else</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">if</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">activeTab </span><span class="token tag script language-javascript operator">===</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'thumbnail'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">generateThumbnail</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript">
</span></span><span class="token plain-text"><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">else</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript keyword control-flow">if</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">activeTab </span><span class="token tag script language-javascript operator">===</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript string">'redesign'</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span><span class="token tag script language-javascript function">generateRedesign</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript">
</span></span><span class="token plain-text"><span class="token tag script language-javascript"></span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag">
</span></span><span class="token plain-text"><span class="token tag"></span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text">              다시 시도
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">button</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token tag punctuation"></</span><span class="token tag">div</span><span class="token tag punctuation">></span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text">      
</span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token operator">!</span><span class="">isLoading </span><span class="token operator">&&</span><span class=""></span><span class="token operator">!</span><span class="">error </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token tag punctuation"><</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="token comment">/* 분석 탭 */</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="token plain-text"><span class="token plain-text"></span><span class="token punctuation">{</span><span class="">activeTab </span><span class="token operator">===</span><span class=""></span><span class="token string">'analysis'</span><span class=""></span><span class="token operator">&&</span><span class=""> data</span><span class="token operator">?.</span><span class="">analysis </span><span class="token operator">&&</span><span class=""></span><span class="token punctuation">(</span><span class="">
</span></span><span class="token plain-text"><span class=""></span><span class="token tag punctuation"><</span><span class="token tag">div</span><span class="token tag"></span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">"</span><span class="token tag attr-value">space-y-4</span><span class="token tag attr-value punctuation">"</span><span class="token tag punctuation">></span><span class="token plain-text">
</span></span><span class="token plain-text">                <div className="border rounded-lg p-4</span></code></div></div></div></pre>

Retry

Claude hit the max length for a message and has paused its response. You can write Continue to keep the chat going.

S

너가짜준코드를보면 굳이 trigger를사용해야할이유가없는거같아. 맞아??

Edit

분석한 코드를 살펴보면, MongoDB Atlas의 트리거를 반드시 사용해야 할 이유가 없어 보입니다. 왜 그런지 설명해 드리겠습니다.

트리거는 데이터베이스에 변화가 발생할 때 자동으로 특정 작업을 실행하는 기능입니다. 하지만 귀하의 애플리케이션 구조에서는 다음과 같은 이유로 트리거가 필수적이지 않습니다:

1. **직접적인 API 호출 가능성** : 코드에서 보면, 사용자가 키워드를 검색하면 서버 측 API 라우트에서 처리를 하고 있습니다. 이 시점에서 YouTube API 요청이나 스크래핑 작업을 직접 호출하거나 큐에 추가할 수 있습니다.
2. **비동기 처리 대안** : NextJS와 Vercel 환경에서는 Edge Functions, Serverless Functions, 또는 백그라운드 작업(Background Jobs)을 활용하여 유사한 기능을 구현할 수 있습니다.
3. **복잡성 증가** : Atlas 트리거를 추가하면 디버깅이 더 어려워지고, 시스템 구조가 복잡해집니다. 특히 로컬 개발 환경과 프로덕션 환경의 차이가 생길 수 있습니다.
4. **데이터 흐름 관리** : 제공하신 코드를 보면 이미 상태 관리(status: "0", "1", "2" 등)를 API 라우트에서 직접 처리하고 있습니다. 이 패턴을 확장하여 스크래핑 작업도 관리할 수 있습니다.

대신 다음과 같은 접근 방식이 더 적합할 수 있습니다:

1. **API 라우트 확장** : 키워드 검색 API에서 스크래핑 서비스를 직접 호출하고, 결과를 받아 저장하는 구조.
2. **큐 시스템 활용** : AWS SQS, RabbitMQ 또는 간단한 데이터베이스 기반 큐를 사용하여 스크래핑 작업을 관리.
3. **Vercel Cron Jobs 또는 Scheduled Functions** : 주기적으로 실행되는 함수로 처리 대기 중인 키워드를 가져와 처리.

귀하의 애플리케이션은 이미 상태 코드를 통해 비동기 처리 패턴을 구현하고 있으므로, 트리거 없이도 효과적으로 동작할 수 있습니다. 트리거는 데이터베이스 변경에 즉각적으로 반응해야 하는 경우나, 외부 시스템에서 데이터를 수정할 때 유용하지만, 현재 구조에서는 필수적이지 않아 보입니다.

**2 / 2**

Retry

S

그럼, nextjs 코드만으로도 블락 없이 스크래핑이 가능할까?
실제로 내 로컬서버를 24시간 켜놓지 않을거고

정말 api ts 파일 안에 코드만으로 vercel에 호스팅을 하면 될까?

Edit

네, NextJS 코드만으로도 Vercel 호스팅 환경에서 스크래핑을 구현할 수 있습니다. 다만, 중요한 제약 사항들과 고려해야 할 점들이 있습니다.

## Vercel 환경에서의 스크래핑 구현 방법

1. **Serverless Function 시간 제한**

   * Vercel의 Serverless Function(API 라우트)은 기본적으로 10초 시간 제한이 있습니다(Pro 플랜에서는 60초).
   * 스크래핑은 종종 10초 이상 걸릴 수 있어 제한시간 내에 완료하지 못할 수 있습니다.
2. **비동기 처리 패턴 구현**

   * 이 문제를 해결하기 위한 일반적인 패턴은 "요청-응답 분리"입니다:
     1. 사용자 요청 시 즉시 작업 ID 반환 (status: "0" 상태로 저장)
     2. 백그라운드 처리를 위한 별도의 메커니즘 사용
     3. 클라이언트가 주기적으로 상태 확인(폴링)
3. **구현 가능한 방법들** **A. Edge Function + 외부 스크래핑 서비스**

   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// pages/api/scrape.ts</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">handler</span><span class="token punctuation">(</span><span class="">req</span><span class="token punctuation">,</span><span class=""> res</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> keyword </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 히스토리 레코드 생성 (status: "0")</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> history </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">    keyword</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// 기타 필드...</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 외부 스크래핑 서비스 API 호출 (비동기적으로 처리)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://your-scraping-service.com/api'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">    method</span><span class="token operator">:</span><span class=""></span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    body</span><span class="token operator">:</span><span class=""></span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
   </span></span><span class=""><span class="">      keyword</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">      callbackUrl</span><span class="token operator">:</span><span class=""></span><span class="token string">'https://your-vercel-app.com/api/webhook/scrape-complete'</span><span class=""> 
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="">err </span><span class="token arrow operator">=></span><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'스크래핑 요청 실패:'</span><span class="token punctuation">,</span><span class=""> err</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 즉시 응답</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> 
   </span></span><span class=""><span class="">    status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class="token punctuation">,</span><span class=""> 
   </span></span><span class=""><span class="">    data</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> history</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> _id</span><span class="token operator">:</span><span class=""> history</span><span class="token punctuation">.</span><span class="token property-access">insertedId</span><span class="token punctuation">,</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class=""> 
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">
   </span><span class=""><span class=""></span><span class="token comment">// pages/api/webhook/scrape-complete.ts</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword module">default</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">handler</span><span class="token punctuation">(</span><span class="">req</span><span class="token punctuation">,</span><span class=""> res</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""></span><span class="token punctuation">{</span><span class=""> historyId</span><span class="token punctuation">,</span><span class=""> results </span><span class="token punctuation">}</span><span class=""></span><span class="token operator">=</span><span class=""> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 데이터베이스 업데이트</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> _id</span><span class="token operator">:</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name maybe-class-name">ObjectId</span><span class="token punctuation">(</span><span class="">historyId</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> $set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="">results</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">'success'</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

   **B. Vercel Cron Jobs**

   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// app/api/cron/process-scraping-queue/route.ts</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">const</span><span class=""> config </span><span class="token operator">=</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">  runtime</span><span class="token operator">:</span><span class=""></span><span class="token string">'edge'</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">
   </span><span class=""><span class=""></span><span class="token keyword module">export</span><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token constant">GET</span><span class="token punctuation">(</span><span class="">request</span><span class="token operator">:</span><span class=""></span><span class="token maybe-class-name">Request</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> authHeader </span><span class="token operator">=</span><span class=""> request</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'authorization'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">if</span><span class=""></span><span class="token punctuation">(</span><span class="">authHeader </span><span class="token operator">!==</span><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">env</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation constant">CRON_SECRET</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name maybe-class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Unauthorized'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">401</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 처리 대기 중인 작업 조회</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> pendingJobs </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"0"</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 각 작업 처리</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">for</span><span class=""></span><span class="token punctuation">(</span><span class="token keyword">const</span><span class=""> job </span><span class="token keyword">of</span><span class=""> pendingJobs</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">try</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> results </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">scrapeYouTube</span><span class="token punctuation">(</span><span class="">job</span><span class="token punctuation">.</span><span class="token property-access">keyword</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">    
   </span><span class=""><span class=""></span><span class="token comment">// 결과 저장</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'videos'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="">results</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">    
   </span><span class=""><span class=""></span><span class="token comment">// 상태 업데이트</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> _id</span><span class="token operator">:</span><span class=""> job</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> $set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"1"</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token keyword control-flow">catch</span><span class=""></span><span class="token punctuation">(</span><span class="">error</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">스크래핑 실패: </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">job</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class=""> error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">await</span><span class=""> db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'keywordHistory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> _id</span><span class="token operator">:</span><span class=""> job</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">{</span><span class=""> $set</span><span class="token operator">:</span><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token string">"2"</span><span class="token punctuation">,</span><span class=""> error</span><span class="token operator">:</span><span class=""> error</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class=""></span><span class="token punctuation">}</span><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""></span><span class="token keyword">new</span><span class=""></span><span class="token class-name maybe-class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Queue processed'</span><span class="token punctuation">,</span><span class=""></span><span class="token punctuation">{</span><span class=""> status</span><span class="token operator">:</span><span class=""></span><span class="token number">200</span><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>

   **C. 경량 스크래핑 (제한된 데이터만 가져오기)**

   <pre><div class="relative flex flex-col rounded-lg"><div class="text-text-300 absolute pl-3 pt-2.5 text-xs">typescript</div><div class="pointer-events-none sticky my-0.5 ml-0.5 flex items-center justify-end px-1.5 py-1 mix-blend-luminosity top-0"><div class="from-bg-300/90 to-bg-300/70 pointer-events-auto rounded-md bg-gradient-to-b p-0.5 backdrop-blur-md"><button class="flex flex-row items-center gap-1 rounded-md p-1 py-0.5 text-xs transition-opacity delay-100 text-text-300 hover:bg-bg-200 opacity-60 hover:opacity-100" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="text-text-500 mr-px -translate-y-[0.5px]"><path d="M200,32H163.74a47.92,47.92,0,0,0-71.48,0H56A16,16,0,0,0,40,48V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm-72,0a32,32,0,0,1,32,32H96A32,32,0,0,1,128,32Zm72,184H56V48H82.75A47.93,47.93,0,0,0,80,64v8a8,8,0,0,0,8,8h80a8,8,0,0,0,8-8V64a47.93,47.93,0,0,0-2.75-16H200Z"></path></svg><span class="text-text-200 pr-0.5">Copy</span></button></div></div><div><div class="prismjs code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed"><code class="language-typescript"><span class=""><span class="token comment">// 제한된 데이터만 가져오는 경량 스크래핑 함수</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">async</span><span class=""></span><span class="token keyword">function</span><span class=""></span><span class="token function">lightScrape</span><span class="token punctuation">(</span><span class="">keyword</span><span class="token punctuation">)</span><span class=""></span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token comment">// YouTube API를 사용하여 기본 데이터 가져오기</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> searchResponse </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://www.googleapis.com/youtube/v3/search?part=snippet&q=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">keyword</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&key=</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">env</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation constant">YOUTUBE_API_KEY</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">&maxResults=10&type=video</span><span class="token template-string template-punctuation string">`</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token keyword">const</span><span class=""> searchData </span><span class="token operator">=</span><span class=""></span><span class="token keyword control-flow">await</span><span class=""> searchResponse</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class="">  
   </span><span class=""><span class=""></span><span class="token comment">// 기본 데이터 변환 및 반환</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token keyword control-flow">return</span><span class=""> searchData</span><span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="">item </span><span class="token arrow operator">=></span><span class=""></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="">
   </span></span><span class=""><span class="">    videoId</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">.</span><span class="token property-access">videoId</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    title</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">snippet</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    thumbnail</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">snippet</span><span class="token punctuation">.</span><span class="token property-access">thumbnails</span><span class="token punctuation">.</span><span class="token property-access">high</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    channelTitle</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">snippet</span><span class="token punctuation">.</span><span class="token property-access">channelTitle</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    channelId</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">snippet</span><span class="token punctuation">.</span><span class="token property-access">channelId</span><span class="token punctuation">,</span><span class="">
   </span></span><span class=""><span class="">    publishDate</span><span class="token operator">:</span><span class=""> item</span><span class="token punctuation">.</span><span class="token property-access">snippet</span><span class="token punctuation">.</span><span class="token property-access">publishedAt</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="">
   </span></span><span class=""><span class=""></span><span class="token punctuation">}</span></span></code></div></div></div></pre>
4. **외부 서비스 사용 옵션**

   * **Bright Data / Zyte** - 클라우드 기반 스크래핑 서비스
   * **Apify / ScrapingBee** - API 기반 웹 스크래핑 서비스
   * **Amazon Lambda** - 더 긴 실행 시간 제한(15분)이 있는 서버리스 함수
   * **작은 전용 서버** - Digital Ocean Droplet이나 Hetzner 같은 저렴한 VPS

## 결론

24시간 서버를 운영하지 않고도 Vercel 환경에서 스크래핑을 구현할 수 있습니다. 하지만 Vercel의 제한 사항을 고려하면 다음과 같은 접근 방식이 가장 현실적입니다:

1. **경량 스크래핑 + 세부 분석 분리**
   * 초기 검색 결과는 YouTube API로 빠르게 가져오기
   * 세부 분석이나 상세 스크래핑은 별도 요청으로 처리
2. **외부 스크래핑 서비스 활용**
   * 복잡한 스크래핑은 전문 서비스에 위임
   * Vercel에서는 결과 처리 및 표시만 담당
3. **정기적인 크론 작업**
   * Vercel Cron Jobs를 사용하여 주기적으로 대기 중인 작업 처리
   * 필요한 경우 매 10분마다 처리하도록 설정

이 방식으로 24시간 서버를 유지하지 않고도 스크래핑과 데이터 분석 기능을 구현할 수 있습니다.
